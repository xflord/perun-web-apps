!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var a,n,s=[],l=!0,r=!1;try{for(i=i.call(e);!(l=(a=i.next()).done)&&(s.push(a.value),!t||s.length!==t);l=!0);}catch(o){r=!0,n=o}finally{try{l||null==i.return||i.return()}finally{if(r)throw n}}return s}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,r=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){o=!0,l=e},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw l}}}}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}(self.webpackChunkperun_web_apps=self.webpackChunkperun_web_apps||[]).push([[749],{89749:function(a,n,l){"use strict";l.r(n),l.d(n,{FacilitiesModule:function(){return qs}});var o=l(61511),c=l(57629),u=l(73916),d=l(17),h=l(75585),f=l(65249),p=l(84140),g=l(68416),m=l(6527),v=l(30570),A=l(31572),I=l(84608),S=l(48958),T=l(66297),y=l(67806),b=l(43691),E=l(36922),Z=l(21575),C=l(15980),_=l(48160);function k(e,t){1&e&&A._UZ(0,"mat-spinner",3)}function O(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",12),A.NdJ("click",function(){return A.CHM(i),A.oxw(2).editFacility()}),A.TgZ(1,"mat-icon"),A._uU(2,"edit"),A.qZA(),A.qZA()}}function L(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",12),A.NdJ("click",function(){return A.CHM(i),A.oxw(2).deleteFacility()}),A.TgZ(1,"mat-icon"),A._uU(2,"delete_forever"),A.qZA(),A.qZA()}}var x=function(){return{color:"black"}},N=function(e){return["/facilities",e]};function R(e,t){if(1&e&&(A.TgZ(0,"div"),A.TgZ(1,"div",4),A._UZ(2,"mat-icon",5),A.ALo(3,"translate"),A.TgZ(4,"div",6),A.TgZ(5,"div",7),A.TgZ(6,"a",8),A._uU(7),A.qZA(),A.TgZ(8,"span",9),A._uU(9),A.qZA(),A.YNc(10,O,3,0,"button",10),A.YNc(11,L,3,0,"button",10),A.qZA(),A.TgZ(12,"span",11),A._uU(13),A.ALo(14,"translate"),A.ALo(15,"translate"),A.qZA(),A.qZA(),A.qZA(),A._UZ(16,"app-animated-router-outlet"),A.qZA()),2&e){var i=A.oxw();A.xp6(2),A.s9C("matTooltip",A.lcZ(3,10,"FACILITY_DETAIL.ENTITY")),A.Q6J("ngStyle",A.DdM(16,x)),A.xp6(4),A.Q6J("routerLink",A.VKq(17,N,i.facility.id)),A.xp6(1),A.Oqu(i.facility.name),A.xp6(2),A.hij(" \xa0#",i.facility.id," "),A.xp6(1),A.Q6J("ngIf",i.editFacilityAuth),A.xp6(1),A.Q6J("ngIf",i.deleteAuth),A.xp6(2),A.lnq(" ",A.lcZ(14,12,"FACILITY_DETAIL.ENTITY"),", ",A.lcZ(15,14,"FACILITY_DETAIL.DESCRIPTION"),": ",i.facility.description," ")}}var D=function(){var e=function(){function e(t,i,a,n,l,r,o,c){s(this,e),this.dialog=t,this.facilityManager=i,this.route=a,this.sideMenuService=n,this.sideMenuItemService=l,this.guiAuthResolver=r,this.router=o,this.entityStorageService=c,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.route.params.subscribe(function(t){e.facilityManager.getFacilityById(t.facilityId).subscribe(function(t){e.facility=t,e.entityStorageService.setEntity({id:t.id,beanName:t.beanName});var i=e.sideMenuItemService.parseFacility(t);e.sideMenuService.setFacilityMenuItems([i]),e.editFacilityAuth=e.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[e.facility]),e.deleteAuth=e.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[e.facility]),(0,p.sF)("facilities",e.facility),(0,p.XI)(e.facility),e.loading=!1},function(){return e.loading=!1})})}},{key:"editFacility",value:function(){var e=this,t=(0,p.kZ)();t.width="450px",t.data={theme:"facility-theme",facility:this.facility,dialogType:m.Eg.FACILITY},this.dialog.open(m.rd,t).afterClosed().subscribe(function(t){t&&e.facilityManager.getFacilityById(e.facility.id).subscribe(function(t){e.facility=t})})}},{key:"deleteFacility",value:function(){var e=this,t=(0,p.kZ)();t.width="500px",t.data={theme:"facility-theme",facility:this.facility},this.dialog.open(v.Y,t).afterClosed().subscribe(function(t){t&&e.router.navigate([""])})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.uw),A.Y36(f.IQ),A.Y36(c.gz),A.Y36(S.D),A.Y36(h.V),A.Y36(g.x4),A.Y36(c.F0),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-detail-page"]],decls:4,vars:2,consts:[[1,"container-fluid","pl-xl-5","pr-xl-5","facility-theme"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["queryParamsHandling","merge",1,"facility-link",3,"routerLink"],[1,"text-muted"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A._UZ(1,"perun-web-apps-back-button"),A.YNc(2,k,1,0,"mat-spinner",1),A.YNc(3,R,17,19,"div",2),A.qZA()),2&e&&(A.xp6(2),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading&&void 0!==t.facility))},directives:[T.W,o.O5,y.$g,b.Hw,E.gM,o.PC,c.yS,Z.A,C.lW],pipes:[_.X$],styles:[""],data:{animation:[d.Ji]}}),e}(),w=l(8557);function F(e,t){1&e&&A._UZ(0,"mat-spinner",2)}function Y(e,t){if(1&e&&(A.TgZ(0,"div"),A._UZ(1,"perun-web-apps-menu-buttons-field",3),A.qZA()),2&e){var i=A.oxw();A.xp6(1),A.Q6J("items",i.navItems)("size","small")}}var U=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityManager=t,this.authResolver=i,this.entityStorageService=a,this.navItems=[],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}},{key:"initItems",value:function(){this.navItems=[],this.authResolver.isAuthorized("getAssignedRichResources_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-manage-facility",url:"/facilities/".concat(this.facility.id,"/resources"),label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedUsers_Facility_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-user",url:"/facilities/".concat(this.facility.id,"/allowed-users"),label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllowedGroups_Facility_Vo_Service_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-group",url:"/facilities/".concat(this.facility.id,"/allowed-groups"),label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.authResolver.isAuthorized("getFacilityServicesState_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service-status",url:"/facilities/".concat(this.facility.id,"/services-status"),label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.authResolver.isAuthorized("getAllRichDestinations_Facility_policy",[this.facility])&&this.navItems.push({cssIcon:"perun-service_destination",url:"/facilities/".concat(this.facility.id,"/services-destinations"),label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.authResolver.isFacilityAdmin()&&this.navItems.push({cssIcon:"perun-hosts",url:"/facilities/".concat(this.facility.id,"/hosts"),label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.navItems.push({cssIcon:"perun-attributes",url:"/facilities/".concat(this.facility.id,"/attributes"),label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"}),(this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])||this.authResolver.isManagerPagePrivileged(this.facility)||this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])||this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility]))&&this.navItems.push({cssIcon:"perun-settings2",url:"/facilities/".concat(this.facility.id,"/settings"),label:"MENU_ITEMS.FACILITY.SETTINGS",style:"facility-btn"})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,t){1&e&&(A.YNc(0,F,1,0,"mat-spinner",0),A.YNc(1,Y,2,2,"div",1)),2&e&&(A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[o.O5,y.$g,w.L],styles:[""]}),e}(),q=l(64467),M=l(39124),J=l(72920),Q=l(76527),V=function(){var e=function e(){s(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},decls:1,vars:0,template:function(e,t){1&e&&A._UZ(0,"app-animated-router-outlet")},directives:[Z.A],styles:[""],data:{animation:[d.Ji]}}),e}();function H(e,t){1&e&&A._UZ(0,"mat-spinner",2)}function P(e,t){if(1&e&&(A.TgZ(0,"div"),A._UZ(1,"perun-web-apps-menu-buttons-field",3),A.qZA()),2&e){var i=A.oxw();A.xp6(1),A.Q6J("items",i.items)("size","small")}}var G=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityManager=t,this.authResolver=i,this.entityStorageService=a,this.items=[],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}},{key:"initItems",value:function(){this.items=[],this.authResolver.isAuthorized("getOwners_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-owner-grey",url:"/facilities/".concat(this.facility.id,"/settings/owners"),label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.authResolver.isManagerPagePrivileged(this.facility)&&this.items.push({cssIcon:"perun-manager",url:"/facilities/".concat(this.facility.id,"/settings/managers"),label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.authResolver.isAuthorized("getAssignedSecurityTeams_Facility_policy",[this.facility])&&this.items.push({cssIcon:"perun-security-teams",url:"/facilities/".concat(this.facility.id,"/settings/security-teams"),label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.authResolver.isAuthorized("getBansForFacility_int_policy",[this.facility])&&this.items.push({cssIcon:"perun-black-list",url:"/facilities/".concat(this.facility.id,"/settings/blacklist"),label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,t){1&e&&(A.YNc(0,H,1,0,"mat-spinner",0),A.YNc(1,P,2,2,"div",1)),2&e&&(A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[o.O5,y.$g,w.L],styles:[""]}),e}(),B=l(55109),j=l(541),$=l(3417);function z(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.hij(" ",A.lcZ(1,1,"FACILITY_DETAIL.ENTITY")," ")}function X(e,t){if(1&e&&A._UZ(0,"app-one-entity-attribute-page",4),2&e){var i=A.oxw();A.Q6J("entity","facility")("entityId",i.facility.id)}}function W(e,t){1&e&&(A._uU(0),A.ALo(1,"translate"),A.ALo(2,"translate")),2&e&&A.AsE(" ",A.lcZ(1,2,"FACILITY_DETAIL.ENTITY")," - ",A.lcZ(2,4,"ADMIN_USER.ENTITY")," ")}function K(e,t){if(1&e&&A._UZ(0,"app-two-entity-attribute-page",5),2&e){var i=A.oxw(2);A.Q6J("firstEntity","facility")("firstEntityId",i.facility.id)("secondEntity","user")}}function ee(e,t){1&e&&(A.TgZ(0,"mat-tab"),A.YNc(1,W,3,6,"ng-template",1),A.YNc(2,K,1,3,"ng-template",2),A.qZA())}var te=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.entityStorageService=i}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entity","entityId"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"mat-tab-group"),A.TgZ(5,"mat-tab"),A.YNc(6,z,2,3,"ng-template",1),A.YNc(7,X,1,2,"ng-template",2),A.qZA(),A.YNc(8,ee,3,0,"mat-tab",3),A.qZA(),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),A.xp6(6),A.Q6J("ngIf",t.facilityUserAttAuth))},directives:[B.SP,B.uX,B.uD,B.Vc,o.O5,j.t,$.Y],pipes:[_.X$],styles:[""]}),e}(),ie=l(77968),ae=l(22927),ne=l(79472),se=l(42473),le=l(16073),re=l(56238),oe=l(79996),ce=l(22280),ue=l(29236),de=l(66283),he=l(80340),fe=l(40084),pe=l(71522),ge=l(22196);function me(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-option",10),A.NdJ("onSelectionChange",function(){var e=A.CHM(i).$implicit;return A.oxw(3).onSelectedService(e)}),A._uU(1),A.qZA()}if(2&e){var a=t.$implicit;A.Q6J("value",a),A.xp6(1),A.hij(" ",a.name," ")}}function ve(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-form-field",6),A.TgZ(1,"input",7),A.NdJ("keyup",function(e){return A.CHM(i),A.oxw(2).updatedSerVal(e)}),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"mat-autocomplete",8,9),A.TgZ(5,"mat-option",10),A.NdJ("onSelectionChange",function(){return A.CHM(i),A.oxw(2).onSelectedService("NOT_SELECTED")}),A._uU(6),A.ALo(7,"translate"),A.qZA(),A.TgZ(8,"mat-option",10),A.NdJ("onSelectionChange",function(){return A.CHM(i),A.oxw(2).onSelectedService("ALL")}),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.YNc(11,me,2,2,"mat-option",11),A.ALo(12,"async"),A.qZA(),A.qZA()}if(2&e){var a=A.MAs(4),n=A.oxw(2);A.xp6(1),A.s9C("placeholder",A.lcZ(2,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),A.Q6J("formControl",n.serviceField)("matAutocomplete",a),A.xp6(2),A.Q6J("displayWith",n.serviceDisplayFn.bind(n)),A.xp6(2),A.Q6J("value","NOT_SELECTED"),A.xp6(1),A.hij(" ",A.lcZ(7,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),A.xp6(2),A.Q6J("value","ALL"),A.xp6(1),A.hij(" ",A.lcZ(10,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),A.xp6(2),A.Q6J("ngForOf",A.lcZ(12,15,n.filteredServices))}}function Ae(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-option",10),A.NdJ("onSelectionChange",function(){var e=A.CHM(i).$implicit;return A.oxw(3).onSelectedResource(e)}),A._uU(1),A.qZA()}if(2&e){var a=t.$implicit;A.Q6J("value",a),A.xp6(1),A.hij(" ",a.name," ")}}function Ie(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-form-field",6),A.TgZ(1,"input",12),A.NdJ("keyup",function(e){return A.CHM(i),A.oxw(2).updatedResVal(e)}),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"mat-autocomplete",8,9),A.YNc(5,Ae,2,2,"mat-option",11),A.ALo(6,"async"),A.qZA(),A.qZA()}if(2&e){var a=A.MAs(4),n=A.oxw(2);A.xp6(1),A.s9C("placeholder",A.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),A.Q6J("matAutocomplete",a)("formControl",n.resourceField),A.xp6(2),A.Q6J("displayWith",n.resourceDisplayFn.bind(n)),A.xp6(2),A.Q6J("ngForOf",A.lcZ(6,7,n.filteredResources))}}function Se(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-option",10),A.NdJ("onSelectionChange",function(){var e=A.CHM(i).$implicit;return A.oxw(3).onSelectedGroup(e)}),A._uU(1),A.qZA()}if(2&e){var a=t.$implicit;A.Q6J("value",a),A.xp6(1),A.hij(" ",a.name," ")}}function Te(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-form-field",6),A.TgZ(1,"input",12),A.NdJ("keyup",function(e){return A.CHM(i),A.oxw(2).updatedGroupVal(e)}),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"mat-autocomplete",13,9),A.YNc(5,Se,2,2,"mat-option",11),A.ALo(6,"async"),A.qZA(),A.qZA()}if(2&e){var a=A.MAs(4),n=A.oxw(2);A.xp6(1),A.s9C("placeholder",A.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),A.Q6J("matAutocomplete",a)("formControl",n.groupField),A.xp6(2),A.Q6J("displayWith",n.groupDisplayFn.bind(n)),A.xp6(2),A.Q6J("ngForOf",A.lcZ(6,7,n.filteredGroups))}}function ye(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-option",10),A.NdJ("onSelectionChange",function(){var e=A.CHM(i).$implicit;return A.oxw(3).onSelectedMember(e)}),A._uU(1),A.ALo(2,"userFullName"),A.qZA()}if(2&e){var a=t.$implicit;A.Q6J("value",a),A.xp6(1),A.hij(" ",A.lcZ(2,2,a.user)," ")}}function be(e,t){if(1&e&&(A.TgZ(0,"mat-form-field",6),A._UZ(1,"input",14),A.ALo(2,"translate"),A.TgZ(3,"mat-autocomplete",8,9),A.YNc(5,ye,3,4,"mat-option",11),A.ALo(6,"async"),A.qZA(),A.qZA()),2&e){var i=A.MAs(4),a=A.oxw(2);A.xp6(1),A.s9C("placeholder",A.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),A.Q6J("formControl",a.memberField)("matAutocomplete",i),A.xp6(2),A.Q6J("displayWith",a.memberDisplayFn.bind(a)),A.xp6(2),A.Q6J("ngForOf",A.lcZ(6,7,a.filteredMembers))}}function Ee(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div",3),A.YNc(1,ve,13,17,"mat-form-field",4),A.TgZ(2,"mat-checkbox",5),A.NdJ("change",function(e){return A.CHM(i),A.oxw().onOfferAllServices(e)}),A._uU(3),A.ALo(4,"translate"),A.qZA(),A.YNc(5,Ie,7,9,"mat-form-field",4),A.YNc(6,Te,7,9,"mat-form-field",4),A.YNc(7,be,7,9,"mat-form-field",4),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("ngIf",void 0!==a.services),A.xp6(2),A.hij(" ",A.lcZ(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),A.xp6(2),A.Q6J("ngIf",void 0!==a.resources&&0!==a.resources.length),A.xp6(1),A.Q6J("ngIf",void 0!==a.selectedResource&&void 0!==a.groups&&0!==a.groups.length),A.xp6(1),A.Q6J("ngIf",void 0!==a.selectedGroup&&void 0!==a.members&&0!==a.members.length)}}function Ze(e,t){if(1&e&&A._UZ(0,"perun-web-apps-service-configurator",15),2&e){var i=A.oxw();A.Q6J("facility",i.facility)("resource",i.selectedResource)("group",i.selectedGroup)("service",i.selectedService)("member",i.selectedMember)}}var Ce=function(){var e=function(){function e(t,i,a,n,l,r,o){var c=this;s(this,e),this.facilityManager=t,this.resourceManager=i,this.serviceManager=a,this.membersManager=n,this.namePipe=l,this.translate=r,this.entityStorageService=o,this.selectedService="NOT_SELECTED",this.attrNames=[],this.serviceField=new le.NI,this.resourceField=new le.NI,this.groupField=new le.NI,this.memberField=new le.NI,this.allowedStatuses=["INVALID","VALID"],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(function(e){return c.serviceAllTranslation=e}),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(function(e){return c.serviceNotSelectedTranslation=e})}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(function(t){e.facility=t,e.facilityManager.getAssignedResourcesForFacility(t.id).subscribe(function(t){return e.resources=t}),e.serviceManager.getAssignedServices(t.id).subscribe(function(t){return e.services=t})}),this.filteredServices=this.serviceField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterServices(t)})),this.filteredResources=this.resourceField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterResources(t)})),this.filteredGroups=this.groupField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterGroups(t)})),this.filteredMembers=this.memberField.valueChanges.pipe((0,re.O)(""),(0,oe.U)(function(t){return e._filterMembers(t)}))}},{key:"onSelectedService",value:function(e){this.selectedService=e}},{key:"onSelectedResource",value:function(e){var t=this;this.selectedResource=e,void 0!==this.selectedResource?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(function(e){return t.groups=e}),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}},{key:"onOfferAllServices",value:function(e){var t=this;e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(function(e){return t.services=e})}},{key:"onSelectedGroup",value:function(e){var t=this;this.selectedGroup=e,void 0!==this.selectedGroup?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,this.attrNames).subscribe(function(e){return t.members=e}),this.selectedMember=void 0):this.members=void 0}},{key:"onSelectedMember",value:function(e){this.selectedMember=e}},{key:"_filterServices",value:function(e){var t=e.toString().toLowerCase();return this.services.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterResources",value:function(e){var t=e.toString().toLowerCase();return this.resources.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterGroups",value:function(e){var t=e.toString().toLowerCase();return this.groups.filter(function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})}},{key:"_filterMembers",value:function(e){var t=this,i=e.toString().toLowerCase();return this.members.filter(function(e){return t.namePipe.transform(e.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i)})}},{key:"serviceDisplayFn",value:function(e){if(null!==e)return"ALL"===e?this.serviceAllTranslation:"NOT_SELECTED"===e?this.serviceNotSelectedTranslation:e.name}},{key:"resourceDisplayFn",value:function(e){if(null!==e)return e.name}},{key:"groupDisplayFn",value:function(e){if(null!==e)return e.name}},{key:"memberDisplayFn",value:function(e){if(null!==e)return this.namePipe.transform(e.user)}},{key:"updatedSerVal",value:function(e){""===e.target.value&&(this.selectedService="NOT_SELECTED")}},{key:"updatedResVal",value:function(e){""===e.target.value&&(this.groups=void 0,this.members=void 0)}},{key:"updatedGroupVal",value:function(e){""===e.target.value&&(this.members=void 0)}},{key:"updatedMemVal",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(f.xk),A.Y36(f.KK),A.Y36(f.uq),A.Y36(ce.dp),A.Y36(_.sK),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","service","member",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["type","text","matInput","",3,"placeholder","matAutocomplete","formControl","keyup"],["autoActiveFirstOption","",3,"ngClass","displayWith"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],[3,"facility","resource","group","service","member"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.YNc(4,Ee,8,7,"div",1),A.YNc(5,Ze,1,5,"perun-web-apps-service-configurator",2),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),A.xp6(2),A.Q6J("ngIf",!!t.facility),A.xp6(1),A.Q6J("ngIf",!!t.facility))},directives:[o.O5,ue.oG,de.KE,he.Nt,le.Fj,fe.ZL,le.JJ,le.oH,fe.XC,pe.ey,o.sg,o.mk],pipes:[_.X$,o.Ov,ge.d],styles:[""]}),e}(),_e=l(489),ke=function(){var e=function(){function e(t,i,a){s(this,e),this.facilityService=t,this.guiAuthResolver=i,this.entityStorageService=a,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme",this.disableRouting=!1,this.disableSelf=!1}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","complementaryObjectType","theme","availableRoles","disableRouting","disableSelf"]],template:function(e,t){1&e&&A._UZ(0,"app-managers-page",0),2&e&&A.Q6J("complementaryObject",t.facility)("complementaryObjectType",t.type)("theme",t.theme)("availableRoles",t.availableRoles)("disableRouting",t.disableRouting)("disableSelf",t.disableSelf)},directives:[_e.s],styles:[""]}),e}(),Oe=l(60611),Le=l(4230),xe=l(60547),Ne=l(4786);function Re(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function De(e,t){1&e&&(A.TgZ(0,"mat-option",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function we(e,t){1&e&&(A.TgZ(0,"mat-option",20),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Fe(e,t){if(1&e&&(A.TgZ(0,"mat-option",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.Q6J("value",i),A.xp6(1),A.hij(" ",i.name," ")}}function Ye(e,t){1&e&&(A.TgZ(0,"mat-error"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function Ue(e,t){if(1&e&&(A.TgZ(0,"mat-option",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit,a=A.oxw(2);A.Q6J("value",i),A.xp6(1),A.hij(" ",a.getTypeForView(i)," ")}}function qe(e,t){1&e&&(A.TgZ(0,"mat-error"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function Me(e,t){1&e&&(A.TgZ(0,"mat-error"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function Je(e,t){if(1&e&&(A.TgZ(0,"mat-form-field",22),A._UZ(1,"input",23),A.YNc(2,qe,3,3,"mat-error",13),A.YNc(3,Me,3,3,"mat-error",13),A.qZA()),2&e){var i=A.oxw(2);A.xp6(1),A.s9C("placeholder",i.getTypeForView(i.selectedType)),A.Q6J("formControl",i.destinationControl),A.xp6(1),A.Q6J("ngIf","host"===i.selectedType&&!i.useFacilityHost&&i.destinationControl.hasError("required")),A.xp6(1),A.Q6J("ngIf",i.destinationControl.hasError("invalidDestination"))}}function Qe(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-checkbox",24),A.NdJ("ngModelChange",function(e){return A.CHM(i),A.oxw(2).useFacilityHost=e}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw(2);A.Q6J("ngModel",a.useFacilityHost),A.xp6(1),A.hij(" ",A.lcZ(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function Ve(e,t){if(1&e&&(A.TgZ(0,"mat-option",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.Q6J("value",i),A.xp6(1),A.hij(" ",i," ")}}function He(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div",7),A.TgZ(1,"div",8),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"mat-form-field"),A.TgZ(5,"mat-select",9),A.ALo(6,"translate"),A.YNc(7,De,3,3,"mat-option",10),A.YNc(8,we,3,3,"mat-option",11),A.YNc(9,Fe,2,2,"mat-option",12),A.qZA(),A.YNc(10,Ye,3,3,"mat-error",13),A.qZA(),A.TgZ(11,"mat-checkbox",14),A.NdJ("change",function(){return A.CHM(i),A.oxw().getServices()})("ngModelChange",function(e){return A.CHM(i),A.oxw().servicesOnFacility=e}),A._uU(12),A.ALo(13,"translate"),A.qZA(),A.TgZ(14,"mat-form-field"),A.TgZ(15,"mat-select",15),A.NdJ("ngModelChange",function(e){return A.CHM(i),A.oxw().selectedType=e})("selectionChange",function(){return A.CHM(i),A.oxw().destinationControl.updateValueAndValidity()}),A.ALo(16,"translate"),A.YNc(17,Ue,2,2,"mat-option",12),A.qZA(),A.qZA(),A.YNc(18,Je,4,4,"mat-form-field",16),A.YNc(19,Qe,3,4,"mat-checkbox",17),A.TgZ(20,"mat-form-field"),A.TgZ(21,"mat-select",18),A.NdJ("ngModelChange",function(e){return A.CHM(i),A.oxw().selectedPropagation=e}),A.ALo(22,"translate"),A.YNc(23,Ve,2,2,"mat-option",12),A.qZA(),A.qZA(),A.TgZ(24,"div",8),A._uU(25),A.ALo(26,"translate"),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(2),A.Oqu(A.lcZ(3,18,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),A.xp6(3),A.s9C("placeholder",A.lcZ(6,20,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),A.Q6J("formControl",a.serviceControl),A.xp6(2),A.Q6J("ngIf",0!==a.services.length),A.xp6(1),A.Q6J("ngIf",0===a.services.length),A.xp6(1),A.Q6J("ngForOf",a.services),A.xp6(1),A.Q6J("ngIf",void 0===a.serviceControl.value),A.xp6(1),A.Q6J("ngModel",a.servicesOnFacility),A.xp6(1),A.Oqu(A.lcZ(13,22,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")),A.xp6(3),A.s9C("placeholder",A.lcZ(16,24,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),A.Q6J("ngModel",a.selectedType),A.xp6(2),A.Q6J("ngForOf",a.types),A.xp6(1),A.Q6J("ngIf",!("host"===a.selectedType&&a.useFacilityHost)),A.xp6(1),A.Q6J("ngIf","host"===a.selectedType),A.xp6(2),A.s9C("placeholder",A.lcZ(22,26,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),A.Q6J("ngModel",a.selectedPropagation),A.xp6(2),A.Q6J("ngForOf",a.propagations),A.xp6(2),A.hij(" ",A.lcZ(26,28,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+a.selectedPropagation)," ")}}var Pe=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.servicesManager=n,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","email","semail","service-specific"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(p.B2),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$")}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.serviceControl=new le.NI(void 0,le.kI.required),this.destinationControl=new le.NI("",this.getDestinationValidator()),this.emailControl=new le.NI("",[le.kI.required,le.kI.pattern(this.emailRegex)]),this.facilitiesManager.getHosts(this.data.facility.id).subscribe(function(t){e.hosts=t,e.servicesOnFacility=!0,e.getServices(),e.loading=!1},function(){return e.loading=!1})}},{key:"getDestinationValidator",value:function(){var e=this;return function(t){if(!t.value)return null;var i;switch(e.selectedType){case"host":case"host-windows-proxy":i=e.hostPattern;break;case"email":case"semail":i=e.emailRegex;break;case"url":i=e.urlPattern;break;case"user@host":case"user@host-windows":i=e.userAtHostPattern;break;case"user@host:port":i=e.userAtHostPortPattern;break;case"service-specific":i=e.serviceSpecificPattern;break;default:return null}return i.test(t.value)?null:{invalidDestination:{value:t.value}}}}},{key:"onCancel",value:function(){this.dialogRef.close()}},{key:"onSubmit",value:function(){var e=this;this.loading=!0,"all"===this.serviceControl.value?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1}):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(function(){e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"getServices",value:function(){var e=this;this.loading=!0,this.servicesOnFacility?0!==this.data.configServices.length?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(function(t){e.services=t},function(){return e.loading=!1}):this.servicesManager.getServices().subscribe(function(t){e.services=t},function(){return e.loading=!1}),this.loading=!1,this.serviceControl.setValue(void 0)}},{key:"getTypeForView",value:function(e){return"semail"===e?"Send Mail":"service-specific"===e?"Service Specific":e}},{key:"invalidDestination",value:function(){return("host"!==this.selectedType||!this.useFacilityHost)&&this.destinationControl.invalid}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.IQ),A.Y36(f.KK))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl","placeholder"],["value","all",4,"ngIf"],["value","noService",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngModel","change","ngModelChange"],[3,"ngModel","placeholder","ngModelChange","selectionChange"],["class","w-100",4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange"],["value","all"],["value","noService"],[3,"value"],[1,"w-100"],["matInput","","required","",3,"formControl","placeholder"],[3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.YNc(4,Re,1,0,"mat-spinner",1),A.YNc(5,He,27,30,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.onCancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.onSubmit()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.Tol(t.data.theme),A.xp6(2),A.Oqu(A.lcZ(3,9,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),A.xp6(2),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),A.xp6(2),A.Q6J("disabled",t.loading||t.invalidDestination()||t.serviceControl.invalid||"noService"===t.serviceControl.value),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," "))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,de.KE,Ne.gD,le.Q7,le.JJ,le.oH,o.sg,ue.oG,le.On,pe.ey,de.TO,he.Nt,le.Fj],pipes:[_.X$],styles:[""],data:{animation:[d.BQ]}}),e}(),Ge=l(59403),Be=l(19139),je=l(39571),$e=l(94357);function ze(e,t){1&e&&(A.TgZ(0,"app-alert",9),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function Xe(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",10),A.NdJ("click",function(){return A.CHM(i),A.oxw().addDestination()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function We(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",11),A.NdJ("click",function(){return A.CHM(i),A.oxw().removeDestination()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function Ke(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",12),A.NdJ("click",function(){return A.CHM(i),A.oxw().onAllow()}),A.TgZ(1,"mat-icon"),A._uU(2," check_circle_outline "),A.qZA(),A._uU(3),A.ALo(4,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length||a.allSelectedAllowed()),A.xp6(3),A.hij(" ",A.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function et(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",12),A.NdJ("click",function(){return A.CHM(i),A.oxw().onBlock()}),A.TgZ(1,"mat-icon"),A._uU(2," block "),A.qZA(),A._uU(3),A.ALo(4,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length||a.allSelectedBlocked()),A.xp6(3),A.hij(" ",A.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function tt(e,t){1&e&&A._UZ(0,"mat-spinner",13)}function it(e,t){if(1&e&&A._UZ(0,"app-perun-web-apps-destination-list",14),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("destinations",i.destinations)("selection",i.selected)("displayedColumns",i.displayedColumns)("services",i.configServicesIds)}}var at=function(){var e=function(){function e(t,i,a,n,l,r,o,c){s(this,e),this.dialog=t,this.facilitiesManager=i,this.servicesManager=a,this.translate=n,this.notificator=l,this.authResolver=r,this.serviceManager=o,this.entityStorageService=c,this.selected=new Le.Ov(!0,[]),this.displayedColumns=["select","destinationId","service","destination","type","propagationType"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new A.vpe,this.filterValue="",this.tableId=Oe.Cf}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(function(t){e.destinations=t,e.destinationEmitter.emit(e.destinations),e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(function(e){return"select"!==e})}},{key:"addDestination",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(Pe,t).afterClosed().subscribe(function(t){t&&e.translate.get("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS").subscribe(function(t){e.refreshTable(),e.notificator.showSuccess(t)})})}},{key:"removeDestination",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(xe.u,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"blockServiceOnDestinations",value:function(e){var t=this;if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),void this.refreshTable();var i=e.pop();this.serviceManager.blockServiceOnDestination(i.service.id,i.id).subscribe(function(){t.blockServiceOnDestinations(e)},function(){return t.loading=!1})}},{key:"onBlock",value:function(){this.loading=!0,this.blockServiceOnDestinations(this.selected.selected)}},{key:"allowServiceOnDestinations",value:function(e){var t=this;if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),void this.refreshTable();var i=e.pop();this.serviceManager.unblockServiceOnDestinationById(i.service.id,i.id).subscribe(function(){t.allowServiceOnDestinations(e)},function(){return t.loading=!1})}},{key:"onAllow",value:function(){this.loading=!0,this.allowServiceOnDestinations(this.selected.selected)}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"allSelectedAllowed",value:function(){return this.selected.selected.reduce(function(e,t){return e&&!t.blocked},!0)}},{key:"allSelectedBlocked",value:function(){return this.selected.selected.reduce(function(e,t){return e&&t.blocked},!0)}}]),e}();return e.id="FacilityServicesDestinationsComponent",e.\u0275fac=function(t){return new(t||e)(A.Y36(I.uw),A.Y36(f.IQ),A.Y36(f.KK),A.Y36(_.sK),A.Y36(g.V6),A.Y36(g.x4),A.Y36(f.KK),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(e,t){2&e&&A.ekj("router-component",t.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:13,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-stroked-button","","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","destinations","selection","displayedColumns","services",4,"ngIf"],["alert_type","info"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-stroked-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","destinations","selection","displayedColumns","services"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.YNc(4,ze,3,3,"app-alert",1),A.TgZ(5,"perun-web-apps-refresh-button",2),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.YNc(6,Xe,3,3,"button",3),A.YNc(7,We,3,4,"button",4),A.YNc(8,Ke,5,4,"button",5),A.YNc(9,et,5,4,"button",5),A.TgZ(10,"perun-web-apps-immediate-filter",6),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(11,tt,1,0,"mat-spinner",7),A.YNc(12,it,1,6,"app-perun-web-apps-destination-list",8),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,9,t.title)),A.xp6(2),A.Q6J("ngIf",t.title.includes("CONFIG")),A.xp6(2),A.Q6J("ngIf",t.addAuth),A.xp6(1),A.Q6J("ngIf",t.removeAuth),A.xp6(1),A.Q6J("ngIf",t.allowAuth),A.xp6(1),A.Q6J("ngIf",t.blockAuth),A.xp6(1),A.Q6J("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[o.O5,Ge.t,Be.L,je.w,C.lW,b.Hw,y.$g,$e.q],pipes:[_.X$],styles:[""]}),e}(),nt=l(17767);function st(e,t){1&e&&A._UZ(0,"mat-spinner",3)}function lt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div"),A.TgZ(1,"perun-web-apps-immediate-filter",4),A.NdJ("filter",function(e){return A.CHM(i),A.oxw().applyFilter(e)}),A.qZA(),A.TgZ(2,"div",5),A._UZ(3,"perun-web-apps-owners-list",6),A.qZA(),A.TgZ(4,"div",7),A.TgZ(5,"button",8),A.NdJ("click",function(){return A.CHM(i),A.oxw().onCancel()}),A._uU(6),A.ALo(7,"translate"),A.qZA(),A.TgZ(8,"button",9),A.NdJ("click",function(){return A.CHM(i),A.oxw().onAdd()}),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("placeholder","DIALOGS.ADD_OWNERS.FILTER"),A.xp6(2),A.Q6J("filterValue",a.filterValue)("tableId",a.tableId)("owners",a.owners)("selection",a.selection),A.xp6(3),A.hij(" ",A.lcZ(7,8,"DIALOGS.ADD_OWNERS.CANCEL")," "),A.xp6(2),A.Q6J("disabled",0===a.selection.selected.length||a.loading),A.xp6(1),A.hij(" ",A.lcZ(10,10,"DIALOGS.ADD_OWNERS.ADD")," ")}}var rt=function(){var e=function(){function e(t,i,a,n,l,r){var o=this;s(this,e),this.dialogRef=t,this.data=i,this.notificator=a,this.translate=n,this.ownersManagerService=l,this.facilitiesManagerService=r,this.extSources=[],this.selection=new Le.Ov(!0,[]),this.filterValue="",this.tableId=Oe.BV,this.owners=[],this.translate.get("DIALOGS.ADD_OWNERS.SUCCESS").subscribe(function(e){return o.successMessage=e})}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.theme=this.data.theme,this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(function(t){e.owners=t.filter(function(t){return!e.data.forbiddenOwners.includes(t.id)}),e.loading=!1},function(){return e.loading=!1})}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"onAdd",value:function(){var e=this;this.loading=!0,0!==this.selection.selected.length?this.facilitiesManagerService.addFacilityOwner(this.data.facilityId,this.selection.selected.pop().id).subscribe(function(){return e.onAdd()},function(){return e.loading=!1}):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(g.V6),A.Y36(_.sK),A.Y36(f.aC),A.Y36(f.IQ))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-add-facility-owner-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"font-size-1rem",3,"placeholder","filter"],["mat-dialog-content",""],[3,"filterValue","tableId","owners","selection"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,st,1,0,"mat-spinner",1),A.YNc(5,lt,11,12,"div",2),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,6,"DIALOGS.ADD_OWNERS.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[I.uh,o.O5,y.$g,Be.L,I.xY,nt.Q,I.H8,C.lW],pipes:[_.X$],styles:[""]}),e}(),ot=l(67033);function ct(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function ut(e,t){1&e&&A._UZ(0,"th",15)}function dt(e,t){if(1&e&&(A.TgZ(0,"td",16),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.hij(" ",i.name," ")}}function ht(e,t){1&e&&A._UZ(0,"tr",17)}function ft(e,t){1&e&&A._UZ(0,"tr",18)}function pt(e,t){if(1&e&&(A.TgZ(0,"div",7),A.TgZ(1,"p"),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",8),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.TgZ(7,"table",9),A.ynx(8,10),A.YNc(9,ut,1,0,"th",11),A.YNc(10,dt,2,1,"td",12),A.BQk(),A.YNc(11,ht,1,0,"tr",13),A.YNc(12,ft,1,0,"tr",14),A.qZA(),A.qZA()),2&e){var i=A.oxw();A.xp6(2),A.hij(" ",A.lcZ(3,5,"DIALOGS.REMOVE_OWNERS.DESCRIPTION")," "),A.xp6(3),A.hij(" ",A.lcZ(6,7,"DIALOGS.REMOVE_OWNERS.ASK")," "),A.xp6(2),A.Q6J("dataSource",i.dataSource),A.xp6(4),A.Q6J("matHeaderRowDef",i.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",i.displayedColumns)}}var gt=function(){var e=function(){function e(t,i,a,n,l){var r=this;s(this,e),this.dialogRef=t,this.data=i,this.notificator=a,this.translate=n,this.facilitiesManagerService=l,this.displayedColumns=["name"],n.get("DIALOGS.REMOVE_OWNERS.SUCCESS").subscribe(function(e){return r.successMessage=e})}return r(e,[{key:"ngOnInit",value:function(){this.dataSource=new ot.by(this.data.owners),this.theme=this.data.theme}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"onSubmit",value:function(){var e=this;this.loading=!0,0!==this.data.owners.length?this.facilitiesManagerService.removeFacilityOwner(this.data.facilityId,this.data.owners.pop().id).subscribe(function(){return e.onSubmit()},function(){return e.loading=!1}):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(g.V6),A.Y36(_.sK),A.Y36(f.IQ))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-remove-facility-owner-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,ct,1,0,"mat-spinner",1),A.YNc(5,pt,13,9,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.onCancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.onSubmit()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,9,"DIALOGS.REMOVE_OWNERS.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.REMOVE_OWNERS.CANCEL")," "),A.xp6(2),A.Q6J("disabled",t.loading),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.REMOVE_OWNERS.DELETE")," "))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,ot.BZ,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,ot.ge,ot.ev,ot.XQ,ot.Gk],pipes:[_.X$],styles:[""]}),e}();function mt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",7),A.NdJ("click",function(){return A.CHM(i),A.oxw().onCreate()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),"\n"))}function vt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",8),A.NdJ("click",function(){return A.CHM(i),A.oxw().onRemove()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selection.selected.length),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),"\n")}}function At(e,t){1&e&&A._UZ(0,"mat-spinner",9)}function It(e,t){if(1&e&&A._UZ(0,"perun-web-apps-owners-list",10),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("owners",i.owners)("displayedColumns",i.displayedColumns)("selection",i.selection)}}var St=function(){var e=function(){function e(t,i,a,n){s(this,e),this.facilitiesManagerService=t,this.dialog=i,this.authResolver=a,this.entityStorageService=n,this.owners=[],this.selection=new Le.Ov(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=Oe.zp,this.ownerEmitter=new A.vpe}return r(e,[{key:"ngOnInit",value:function(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(function(t){e.owners=t,e.ownerEmitter.emit(e.owners),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"onCreate",value:function(){var e=this,t=(0,p.kZ)();t.width="800px",t.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(function(e){return e.id})},this.dialog.open(rt,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"onRemove",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(gt,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(I.uw),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","mr-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","owners","displayedColumns","selection",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","owners","displayedColumns","selection"]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.YNc(4,mt,3,3,"button",2),A.YNc(5,vt,3,4,"button",3),A.TgZ(6,"perun-web-apps-immediate-filter",4),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(7,At,1,0,"mat-spinner",5),A.YNc(8,It,1,5,"perun-web-apps-owners-list",6)),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),A.xp6(3),A.Q6J("ngIf",t.addAuth),A.xp6(1),A.Q6J("ngIf",t.removeAuth),A.xp6(1),A.Q6J("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,o.O5,Be.L,C.lW,y.$g,nt.Q],pipes:[_.X$],styles:[""]}),e}(),Tt=l(84534);function yt(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function bt(e,t){1&e&&(A.TgZ(0,"mat-error"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function Et(e,t){if(1&e&&(A.TgZ(0,"mat-error"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e){var i=A.oxw(2);A.xp6(1),A.AsE(" ",A.lcZ(2,2,"DIALOGS.ADD_HOST.INVALID_HOST"),"",i.hostsCtrl.getError("invalidHost").value," ")}}function Zt(e,t){if(1&e&&(A.TgZ(0,"div",7),A.TgZ(1,"mat-form-field"),A.TgZ(2,"textarea",8),A.ALo(3,"translate"),A._uU(4,"      "),A.qZA(),A.YNc(5,bt,3,3,"mat-error",9),A.YNc(6,Et,3,4,"mat-error",9),A.qZA(),A.TgZ(7,"app-alert",10),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.qZA()),2&e){var i=A.oxw();A.xp6(2),A.Q6J("placeholder",A.lcZ(3,5,"DIALOGS.ADD_HOST.SUBTITLE"))("formControl",i.hostsCtrl),A.xp6(3),A.Q6J("ngIf",i.hostsCtrl.hasError("required")),A.xp6(1),A.Q6J("ngIf",i.hostsCtrl.hasError("invalidHost")),A.xp6(2),A.Oqu(A.lcZ(9,7,"DIALOGS.ADD_HOST.HINT"))}}var Ct=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.notificator=n,this.translate=l,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.facilityName=this.data.facilityName,this.hostsCtrl=new le.NI("",[le.kI.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}},{key:"onAdd",value:function(){var e=this;this.loading=!0;var t,a=[],n=i(this.hostsCtrl.value.split("\n"));try{for(n.s();!(t=n.n()).done;){var s=t.value;a=a.concat(this.parseHostName(s))}}catch(l){n.e(l)}finally{n.f()}this.facilitiesManager.addHosts(this.data.facilityId,a).subscribe(function(){e.notificator.showSuccess(e.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"hostsNameValidator",value:function(){var e=this;return function(t){var a,n=[],s=i(t.value.split("\n"));try{for(s.s();!(a=s.n()).done;){var l=a.value;n=n.concat(e.parseHostName(l))}}catch(u){s.e(u)}finally{s.f()}var r,o=i(n);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(!e.hostPattern.test(c))return{invalidHost:{value:c}}}}catch(u){o.e(u)}finally{o.f()}return null}}},{key:"parseHostName",value:function(e){var i=new RegExp("[[0-9]+-[0-9]+]","g"),a=e.split(i),n=e.match(i);if(null==n)return""===e?[]:[e];for(var s=[],l=0;l<a.length-1;l++){for(var r=t(this.parseRange(n[l]),2),o=r[0],c=r[1],u=[],d=o;d<=c;d++)u=u.concat(a[l].concat(d.toString()));s=s.concat([u])}return s=s.concat([a[a.length-1]]),this.joinHostNames(s,0)}},{key:"parseRange",value:function(e){var i=t(e.split("-"),2),a=i[0],n=i[1];return[parseInt(a.substring(1,a.length),10),parseInt(n.substring(0,n.length),10)]}},{key:"joinHostNames",value:function(e,t){if(t===e.length-1)return[e[t]];var a,n=this.joinHostNames(e,t+1),s=[],l=i(e[t]);try{for(l.s();!(a=l.n()).done;){var r,o=a.value,c=i(n);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(o.concat(u))}}catch(d){c.e(d)}finally{c.f()}}}catch(d){l.e(d)}finally{l.f()}return s}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.IQ),A.Y36(g.V6),A.Y36(_.sK))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-add-host-dialog"]],decls:13,vars:16,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","","class","dialog-container",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","accent",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content","",1,"dialog-container"],["id","facilityAddHost","name","facilityAddHost","rows","8","cols","50","matInput","","required","","perunWebAppsAutoFocus","",1,"md-textarea","form-control",3,"placeholder","formControl"],[4,"ngIf"],["alert_type","info"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.YNc(4,yt,1,0,"mat-spinner",1),A.YNc(5,Zt,10,9,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.onCancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.onAdd()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.Tol(t.theme),A.xp6(2),A.AsE("",t.facilityName,": ",A.lcZ(3,10,"DIALOGS.ADD_HOST.TITLE"),""),A.xp6(2),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,12,"DIALOGS.ADD_HOST.CANCEL"),""),A.xp6(2),A.Q6J("disabled",t.hostsCtrl.invalid||t.loading),A.xp6(1),A.hij(" ",A.lcZ(12,14,"DIALOGS.ADD_HOST.ADD"),""))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,de.KE,he.Nt,le.Fj,le.Q7,Tt.hT,le.JJ,le.oH,je.w,de.TO],pipes:[_.X$],styles:[""]}),e}();function _t(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function kt(e,t){1&e&&A._UZ(0,"th",15)}function Ot(e,t){if(1&e&&(A.TgZ(0,"td",16),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.hij(" ",i.hostname," ")}}function Lt(e,t){1&e&&A._UZ(0,"tr",17)}function xt(e,t){1&e&&A._UZ(0,"tr",18)}function Nt(e,t){if(1&e&&(A.TgZ(0,"div",7),A.TgZ(1,"p"),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",8),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.TgZ(7,"table",9),A.ynx(8,10),A.YNc(9,kt,1,0,"th",11),A.YNc(10,Ot,2,1,"td",12),A.BQk(),A.YNc(11,Lt,1,0,"tr",13),A.YNc(12,xt,1,0,"tr",14),A.qZA(),A.qZA()),2&e){var i=A.oxw();A.xp6(2),A.Oqu(A.lcZ(3,5,"DIALOGS.REMOVE_HOST.DESCRIPTION")),A.xp6(3),A.hij(" ",A.lcZ(6,7,"DIALOGS.REMOVE_HOST.ASK")," "),A.xp6(2),A.Q6J("dataSource",i.dataSource),A.xp6(4),A.Q6J("matHeaderRowDef",i.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",i.displayedColumns)}}var Rt=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.facilitiesManager=a,this.notificator=n,this.translate=l,this.displayedColumns=["name"],this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new ot.by(this.data.hosts)}},{key:"onConfirm",value:function(){var e=this;this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(function(e){return e.id})).subscribe(function(){e.notificator.showSuccess(e.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),e.dialogRef.close(!0)},function(){return e.loading=!1})}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.IQ),A.Y36(g.V6),A.Y36(_.sK))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-remove-host-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,_t,1,0,"mat-spinner",1),A.YNc(5,Nt,13,9,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.onCancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.onConfirm()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,9,"DIALOGS.REMOVE_HOST.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.REMOVE_HOST.CANCEL"),""),A.xp6(2),A.Q6J("disabled",t.loading),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.REMOVE_HOST.CONFIRM"),""))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,ot.BZ,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,ot.ge,ot.ev,ot.XQ,ot.Gk],pipes:[_.X$],styles:[""]}),e}(),Dt=l(58623),wt=l(82819);function Ft(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"th",14),A.TgZ(1,"mat-checkbox",15),A.NdJ("change",function(e){A.CHM(i);var t=A.oxw();return e?t.masterToggle():null}),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function Yt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"td",16),A.TgZ(1,"mat-checkbox",17),A.NdJ("change",function(e){var t=A.CHM(i).$implicit,a=A.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),A.qZA(),A.qZA()}if(2&e){var a=t.$implicit,n=A.oxw();A.xp6(1),A.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function Ut(e,t){1&e&&(A.TgZ(0,"th",18),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")))}function qt(e,t){if(1&e&&(A.TgZ(0,"td",19),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.id)}}function Mt(e,t){1&e&&(A.TgZ(0,"th",18),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")))}function Jt(e,t){if(1&e&&(A.TgZ(0,"td",20),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.hostname)}}function Qt(e,t){1&e&&A._UZ(0,"tr",21)}var Vt=function(e,t){return["/facilities",e,"hosts",t]};function Ht(e,t){if(1&e&&A._UZ(0,"tr",22),2&e){var i=t.$implicit,a=A.oxw();A.Q6J("perunWebAppsMiddleClickRouterLink",a.disableRouting?null:A.WLB(2,Vt,a.facilityId,i.id))("routerLink",a.disableRouting?null:A.WLB(5,Vt,a.facilityId,i.id))}}function Pt(e,t){1&e&&(A.TgZ(0,"app-alert",23),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Gt(e,t){1&e&&(A.TgZ(0,"app-alert",23),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING"),"\n"))}var Bt=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.hosts=[],this.selection=new Le.Ov(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new ot.by(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"name":return e.hostname;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.UA))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-hosts-list"]],viewQuery:function(e,t){var i;(1&e&&(A.Gf(Dt.YE,7),A.Gf(p.l9,7)),2&e)&&(A.iGM(i=A.CRH())&&(t.matSort=i.first),A.iGM(i=A.CRH())&&(t.child=i.first))},inputs:{hosts:"hosts",selection:"selection",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns"},features:[A.TTD],decls:16,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"],["alert_type","warn"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"perun-web-apps-table-wrapper",1),A.NdJ("exportData",function(e){return t.exportData(e)}),A.TgZ(2,"table",2),A.ynx(3,3),A.YNc(4,Ft,2,3,"th",4),A.YNc(5,Yt,2,2,"td",5),A.BQk(),A.ynx(6,6),A.YNc(7,Ut,3,3,"th",7),A.YNc(8,qt,2,1,"td",8),A.BQk(),A.ynx(9,9),A.YNc(10,Mt,3,3,"th",7),A.YNc(11,Jt,2,1,"td",10),A.BQk(),A.YNc(12,Qt,1,0,"tr",11),A.YNc(13,Ht,1,8,"tr",12),A.qZA(),A.qZA(),A.qZA(),A.YNc(14,Pt,3,3,"app-alert",13),A.YNc(15,Gt,3,3,"app-alert",13)),2&e&&(A.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.hosts.length),A.xp6(1),A.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),A.xp6(1),A.Q6J("dataSource",t.dataSource),A.xp6(10),A.Q6J("matHeaderRowDef",t.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",t.displayedColumns),A.xp6(1),A.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.hosts.length),A.xp6(1),A.Q6J("ngIf",0===t.hosts.length))},directives:[wt.l,ot.BZ,Dt.YE,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,o.O5,ot.ge,ue.oG,ot.ev,Dt.nU,ot.XQ,ot.Gk,Tt.YH,c.rH,je.w],pipes:[_.X$],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),e}();function jt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",7),A.NdJ("click",function(){return A.CHM(i),A.oxw().addHost()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function $t(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",8),A.NdJ("click",function(){return A.CHM(i),A.oxw().removeHost()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function zt(e,t){1&e&&A._UZ(0,"mat-spinner",9)}function Xt(e,t){if(1&e&&A._UZ(0,"app-hosts-list",10),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("hosts",i.hosts)("selection",i.selected)("displayedColumns",i.displayedColumns)("disableRouting",!i.routeAuth||i.disableRouting)("facilityId",i.facility.id)}}var Wt=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.facilitiesManager=i,this.authResolver=a,this.entityStorageService=n,this.disableRouting=!1,this.hosts=[],this.selected=new Le.Ov(!0,[]),this.filterValue="",this.tableId=Oe.eq,this.displayedColumns=["id","name"],this.hostEmitter=new A.vpe}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.facilitiesManager.getFacilityById(this.facility.id).subscribe(function(t){e.facility=t,e.refreshTable()})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(function(t){e.hosts=t,e.hostEmitter.emit(e.hosts),e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],0!==this.hosts.length&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}},{key:"addHost",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facilityId:this.facility.id,facilityName:this.facility.name,theme:"facility-theme"},this.dialog.open(Ct,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"removeHost",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(Rt,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.uw),A.Y36(f.IQ),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:10,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2 action-button",3,"click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2","action-button",3,"click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","hosts","selection","displayedColumns","disableRouting","facilityId"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.YNc(5,jt,3,3,"button",2),A.YNc(6,$t,3,4,"button",3),A.TgZ(7,"perun-web-apps-immediate-filter",4),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(8,zt,1,0,"mat-spinner",5),A.YNc(9,Xt,1,7,"app-hosts-list",6),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),A.xp6(3),A.Q6J("ngIf",t.addAuth),A.xp6(1),A.Q6J("ngIf",t.removeAuth),A.xp6(1),A.Q6J("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,o.O5,Be.L,C.lW,y.$g,Bt],pipes:[_.X$],styles:[""]}),e}();function Kt(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"th",15),A.TgZ(1,"mat-checkbox",16),A.NdJ("change",function(e){A.CHM(i);var t=A.oxw();return e?t.masterToggle():null}),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function ei(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"td",17),A.TgZ(1,"mat-checkbox",18),A.NdJ("change",function(e){var t=A.CHM(i).$implicit,a=A.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),A.qZA(),A.qZA()}if(2&e){var a=t.$implicit,n=A.oxw();A.xp6(1),A.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function ti(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.USER_ID")))}function ii(e,t){if(1&e&&(A.TgZ(0,"td",20),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i[1].id)}}function ai(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NAME")))}function ni(e,t){if(1&e&&(A.TgZ(0,"td",21),A._uU(1),A.ALo(2,"userFullName"),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(A.lcZ(2,1,i[1]))}}function si(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.REASON")))}function li(e,t){if(1&e&&(A.TgZ(0,"td",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i[0].description)}}function ri(e,t){1&e&&A._UZ(0,"tr",22)}function oi(e,t){1&e&&A._UZ(0,"tr",23)}function ci(e,t){1&e&&(A.TgZ(0,"app-alert",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function ui(e,t){1&e&&(A.TgZ(0,"app-alert",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NO_BANS_WARNING"),"\n"))}var di=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.bansOnFacilitiesWithUsers=[],this.selection=new Le.Ov(!0,[]),this.displayedColumns=["select","userId","name","reason"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"userId"!==e})),this.dataSource=new ot.by(this.bansOnFacilitiesWithUsers),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"userId":return e[1].id.toString();case"reason":return e[0].description;case"name":return(0,p.hu)(e[1]);default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e[0].userId+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.UA))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-perun-web-apps-blacklist-list"]],viewQuery:function(e,t){var i;(1&e&&(A.Gf(Dt.YE,7),A.Gf(p.l9,7)),2&e)&&(A.iGM(i=A.CRH())&&(t.matSort=i.first),A.iGM(i=A.CRH())&&(t.child=i.first))},inputs:{bansOnFacilitiesWithUsers:"bansOnFacilitiesWithUsers",selection:"selection",filterValue:"filterValue",tableId:"tableId"},features:[A.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","userId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","reason"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"perun-web-apps-table-wrapper",1),A.NdJ("exportData",function(e){return t.exportData(e)}),A.TgZ(2,"table",2),A.ynx(3,3),A.YNc(4,Kt,2,3,"th",4),A.YNc(5,ei,2,2,"td",5),A.BQk(),A.ynx(6,6),A.YNc(7,ti,3,3,"th",7),A.YNc(8,ii,2,1,"td",8),A.BQk(),A.ynx(9,9),A.YNc(10,ai,3,3,"th",7),A.YNc(11,ni,3,3,"td",10),A.BQk(),A.ynx(12,11),A.YNc(13,si,3,3,"th",7),A.YNc(14,li,2,1,"td",10),A.BQk(),A.YNc(15,ri,1,0,"tr",12),A.YNc(16,oi,1,0,"tr",13),A.qZA(),A.qZA(),A.qZA(),A.YNc(17,ci,3,3,"app-alert",14),A.YNc(18,ui,3,3,"app-alert",14)),2&e&&(A.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.bansOnFacilitiesWithUsers.length),A.xp6(1),A.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),A.xp6(1),A.Q6J("dataSource",t.dataSource),A.xp6(13),A.Q6J("matHeaderRowDef",t.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",t.displayedColumns),A.xp6(1),A.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.bansOnFacilitiesWithUsers.length),A.xp6(1),A.Q6J("ngIf",0===t.bansOnFacilitiesWithUsers.length))},directives:[wt.l,ot.BZ,Dt.YE,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,o.O5,ot.ge,ue.oG,ot.ev,Dt.nU,ot.XQ,ot.Gk,je.w],pipes:[_.X$,ge.d],styles:[""]}),e}();function hi(e,t){1&e&&A._UZ(0,"mat-spinner",5)}function fi(e,t){if(1&e&&A._UZ(0,"app-perun-web-apps-blacklist-list",6),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("bansOnFacilitiesWithUsers",i.bansOnFacilitiesWithUsers)("selection",i.selected)}}var pi=function(){var e=function(){function e(t,i,a){s(this,e),this.facilitiesManager=t,this.usersManager=i,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new Le.Ov(!0,[]),this.filterValue="",this.tableId=Oe.NG}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(function(t){var a,n=i(t);try{for(n.s();!(a=n.n()).done;){var s=a.value,l=void 0;e.usersManager.getUserById(s.userId).subscribe(function(e){l=e}),e.bansOnFacilitiesWithUsers.push([s,l])}}catch(r){n.e(r)}finally{n.f()}e.selected.clear(),e.loading=!1})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(f.Fv),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","bansOnFacilitiesWithUsers","selection"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.TgZ(5,"perun-web-apps-immediate-filter",2),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.ALo(6,"translate"),A.qZA(),A.YNc(7,hi,1,0,"mat-spinner",3),A.YNc(8,fi,1,4,"app-perun-web-apps-blacklist-list",4),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),A.xp6(3),A.Q6J("placeholder",A.lcZ(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),A.xp6(2),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,Be.L,o.O5,y.$g,di],pipes:[_.X$],styles:[""]}),e}(),gi=l(41939),mi=l(13572),vi=l(40695),Ai=l(41186),Ii=["list"];function Si(e,t){1&e&&A._UZ(0,"mat-spinner",7)}function Ti(e,t){if(1&e&&A._UZ(0,"perun-web-apps-attributes-list",8,9),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("attributes",i.attributes)("selection",i.selected)}}var yi=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.attributesManager=i,this.facilityManager=a,this.route=n,this.attributes=[],this.selected=new Le.Ov(!0,[]),this.host={beanName:"",id:0},this.tableId=Oe.rF}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.route.params.subscribe(function(t){e.hostId=t.hostId,e.facilityManager.getHostById(e.hostId).subscribe(function(t){e.host=t}),e.refreshTable()})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.attributesManager.getHostAttributes(this.hostId).subscribe(function(t){e.attributes=(0,p.MX)(t),e.selected.clear(),e.loading=!1})}},{key:"onSave",value:function(){var e=this;this.list.updateMapAttributes();var t=(0,p.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected},this.dialog.open(m.wA,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"addAttribute",value:function(){var e=this,t=(0,p.kZ)();t.width="1050px",t.data={entityId:this.hostId,entity:"host",notEmptyAttributes:this.attributes,style:"facility-theme"},this.dialog.open(vi.n,t).afterClosed().subscribe(function(t){"saved"===t&&e.refreshTable()})}},{key:"removeAttribute",value:function(){var e=this,t=(0,p.kZ)();t.width="450px",t.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected,theme:"facility-theme"},this.dialog.open(mi.k,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.uw),A.Y36(f.H8),A.Y36(f.IQ),A.Y36(c.gz))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-hosts-detail"]],viewQuery:function(e,t){var i;(1&e&&A.Gf(Ii,5),2&e)&&(A.iGM(i=A.CRH())&&(t.list=i.first))},decls:16,vars:17,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent",1,"mr-2",3,"click"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",3,"disabled","click"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","attributes","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","attributes","selection"],["list",""]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.TgZ(5,"button",2),A.NdJ("click",function(){return t.addAttribute()}),A._uU(6),A.ALo(7,"translate"),A.qZA(),A.TgZ(8,"button",3),A.NdJ("click",function(){return t.onSave()}),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.TgZ(11,"button",4),A.NdJ("click",function(){return t.removeAttribute()}),A._uU(12),A.ALo(13,"translate"),A.qZA(),A.YNc(14,Si,1,0,"mat-spinner",5),A.YNc(15,Ti,2,3,"perun-web-apps-attributes-list",6),A.qZA()),2&e&&(A.xp6(2),A.AsE(" ",A.lcZ(3,9,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",t.host.hostname,""),A.xp6(4),A.hij(" ",A.lcZ(7,11,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.ADD")," "),A.xp6(2),A.Q6J("disabled",0===t.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(10,13,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.SAVE")," "),A.xp6(2),A.Q6J("disabled",0===t.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(13,15,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.REMOVE")," "),A.xp6(2),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,C.lW,o.O5,y.$g,Ai.p],pipes:[_.X$],styles:[""]}),e}();function bi(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"th",15),A.TgZ(1,"mat-checkbox",16),A.NdJ("change",function(e){A.CHM(i);var t=A.oxw();return e?t.masterToggle():null}),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function Ei(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"td",17),A.TgZ(1,"mat-checkbox",18),A.NdJ("change",function(e){var t=A.CHM(i).$implicit,a=A.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),A.qZA(),A.qZA()}if(2&e){var a=t.$implicit,n=A.oxw();A.xp6(1),A.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function Zi(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.ID")))}function Ci(e,t){if(1&e&&(A.TgZ(0,"td",20),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.id)}}function _i(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NAME")))}function ki(e,t){if(1&e&&(A.TgZ(0,"td",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.name)}}function Oi(e,t){1&e&&(A.TgZ(0,"th",19),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.DESCRIPTION")))}function Li(e,t){if(1&e&&(A.TgZ(0,"td",21),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.description)}}function xi(e,t){1&e&&A._UZ(0,"tr",22)}function Ni(e,t){1&e&&A._UZ(0,"tr",23)}function Ri(e,t){1&e&&(A.TgZ(0,"app-alert",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Di(e,t){1&e&&(A.TgZ(0,"app-alert",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NO_SECURITY_TEAMS_WARNING"),"\n"))}var wi=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.securityTeams=[],this.selection=new Le.Ov(!0,[]),this.displayedColumns=["select","id","name","description"],this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new ot.by(this.securityTeams),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"name":return e.name;case"description":return e.description;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.UA))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-security-teams-list"]],viewQuery:function(e,t){var i;(1&e&&(A.Gf(Dt.YE,7),A.Gf(p.l9,7)),2&e)&&(A.iGM(i=A.CRH())&&(t.matSort=i.first),A.iGM(i=A.CRH())&&(t.child=i.first))},inputs:{securityTeams:"securityTeams",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[A.TTD],decls:19,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"perun-web-apps-table-wrapper",1),A.NdJ("exportData",function(e){return t.exportData(e)}),A.TgZ(2,"table",2),A.ynx(3,3),A.YNc(4,bi,2,3,"th",4),A.YNc(5,Ei,2,2,"td",5),A.BQk(),A.ynx(6,6),A.YNc(7,Zi,3,3,"th",7),A.YNc(8,Ci,2,1,"td",8),A.BQk(),A.ynx(9,9),A.YNc(10,_i,3,3,"th",7),A.YNc(11,ki,2,1,"td",10),A.BQk(),A.ynx(12,11),A.YNc(13,Oi,3,3,"th",7),A.YNc(14,Li,2,1,"td",10),A.BQk(),A.YNc(15,xi,1,0,"tr",12),A.YNc(16,Ni,1,0,"tr",13),A.qZA(),A.qZA(),A.qZA(),A.YNc(17,Ri,3,3,"app-alert",14),A.YNc(18,Di,3,3,"app-alert",14)),2&e&&(A.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.securityTeams.length),A.xp6(1),A.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),A.xp6(1),A.Q6J("dataSource",t.dataSource),A.xp6(13),A.Q6J("matHeaderRowDef",t.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",t.displayedColumns),A.xp6(1),A.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.securityTeams.length),A.xp6(1),A.Q6J("ngIf",0===t.securityTeams.length))},directives:[wt.l,ot.BZ,Dt.YE,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,o.O5,ot.ge,ue.oG,ot.ev,Dt.nU,ot.XQ,ot.Gk,je.w],pipes:[_.X$],styles:[""]}),e}();function Fi(e,t){1&e&&A._UZ(0,"mat-spinner",5)}function Yi(e,t){if(1&e&&A._UZ(0,"app-security-teams-list",6),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("filterValue",i.filterValue)("securityTeams",i.securityTeams)("displayedColumns",i.displayedColumns)("selection",i.selected)}}var Ui=function(){var e=function(){function e(t,i,a,n){s(this,e),this.dialog=t,this.facilitiesManager=i,this.authResolver=a,this.entityStorageService=n,this.securityTeams=[],this.selected=new Le.Ov(!0,[]),this.filterValue="",this.tableId=Oe.O9,this.displayedColumns=[]}return r(e,[{key:"ngOnInit",value:function(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(function(t){e.securityTeams=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"addSecurityTeam",value:function(){}},{key:"removeSecurityTeam",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.uw),A.Y36(f.IQ),A.Y36(g.x4),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-security-teams"]],decls:8,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","securityTeams","displayedColumns","selection"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.TgZ(5,"perun-web-apps-immediate-filter",2),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(6,Fi,1,0,"mat-spinner",3),A.YNc(7,Yi,1,5,"app-security-teams-list",4),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),A.xp6(3),A.Q6J("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,Be.L,o.O5,y.$g,wi],pipes:[_.X$],styles:[""]}),e}(),qi=l(64359),Mi=l(75374);function Ji(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function Qi(e,t){1&e&&(A.TgZ(0,"th",17),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")))}function Vi(e,t){if(1&e&&(A.TgZ(0,"td",18),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.hij(" ",i.id," ")}}function Hi(e,t){1&e&&(A.TgZ(0,"th",17),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")))}function Pi(e,t){if(1&e&&(A.TgZ(0,"td",18),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.hij(" ",i.destination.destination," ")}}function Gi(e,t){1&e&&(A.TgZ(0,"th",17),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")))}function Bi(e,t){if(1&e&&(A.TgZ(0,"td",18),A._uU(1),A.ALo(2,"date"),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.hij(" ",A.xi3(2,1,i.timestamp,"d.M.y H:mm:ss")," ")}}function ji(e,t){1&e&&A._UZ(0,"tr",19)}function $i(e,t){1&e&&A._UZ(0,"tr",20)}function zi(e,t){if(1&e&&(A.TgZ(0,"div",7),A.TgZ(1,"p"),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",8),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.TgZ(7,"table",9),A.ynx(8,10),A.YNc(9,Qi,3,3,"th",11),A.YNc(10,Vi,2,1,"td",12),A.BQk(),A.ynx(11,13),A.YNc(12,Hi,3,3,"th",11),A.YNc(13,Pi,2,1,"td",12),A.BQk(),A.ynx(14,14),A.YNc(15,Gi,3,3,"th",11),A.YNc(16,Bi,3,4,"td",12),A.BQk(),A.YNc(17,ji,1,0,"tr",15),A.YNc(18,$i,1,0,"tr",16),A.qZA(),A.qZA()),2&e){var i=A.oxw();A.xp6(2),A.Oqu(A.lcZ(3,5,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),A.xp6(3),A.hij(" ",A.lcZ(6,7,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),A.xp6(2),A.Q6J("dataSource",i.dataSource),A.xp6(10),A.Q6J("matHeaderRowDef",i.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",i.displayedColumns)}}var Xi=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.taskManager=a,this.notificator=n,this.translate=l,this.loading=!1,this.dataSource=new ot.by(this.data.taskResults),this.displayedColumns=["id","destination","time"]}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}},{key:"deleteResults",value:function(){var e=this;if(this.loading=!0,0===this.taskResults.length)return this.dialogRef.close(!0),this.loading=!1,void this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"));this.taskManager.deleteTaskResultById({taskResultId:this.taskResults.pop().id}).subscribe(function(){e.deleteResults()},function(){return e.loading=!1})}},{key:"onDelete",value:function(){this.deleteResults()}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.Ob),A.Y36(g.V6),A.Y36(_.sK))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-delete-task-result-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["mat-header-row","","class","font-weight-bolder",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,Ji,1,0,"mat-spinner",1),A.YNc(5,zi,19,9,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.onCancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.onDelete()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),A.xp6(2),A.Q6J("disabled",t.loading),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," "))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,ot.BZ,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,ot.ge,ot.ev,ot.XQ,ot.Gk],pipes:[_.X$,o.uU],styles:[""]}),e}(),Wi=l(88884);function Ki(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function ea(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-checkbox",13),A.NdJ("change",function(e){return A.CHM(i),A.oxw(2).change(e)}),A.ALo(1,"translate"),A._uU(2),A.ALo(3,"translate"),A.qZA()}if(2&e){var a=A.oxw(2);A.s9C("matTooltip",A.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),A.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.taskChecked),A.xp6(2),A.hij(" ",A.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function ta(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-checkbox",14),A.NdJ("change",function(e){return A.CHM(i),A.oxw(2).change(e)}),A.ALo(1,"translate"),A._uU(2),A.ALo(3,"translate"),A.qZA()}if(2&e){var a=A.oxw(2);A.s9C("matTooltip",A.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),A.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.taskResultsChecked),A.xp6(2),A.hij(" ",A.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function ia(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"perun-web-apps-resources-list",15),A.NdJ("allSelected",function(e){return A.CHM(i),A.oxw(2).disableCheckboxes(e)}),A.qZA()}if(2&e){var a=A.oxw(2);A.Q6J("tableId",a.tableId)("disableRouting",!0)("resources",a.resources)("selection",a.selected)("displayedColumns",a.displayedColumns)}}function aa(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div",7),A.TgZ(1,"p"),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div"),A.YNc(5,ea,4,9,"mat-checkbox",8),A.YNc(6,ta,4,9,"mat-checkbox",9),A.TgZ(7,"mat-checkbox",10),A.NdJ("change",function(e){return A.CHM(i),A.oxw().change(e)}),A.ALo(8,"translate"),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.qZA(),A.TgZ(11,"p"),A._uU(12),A.ALo(13,"translate"),A.qZA(),A.TgZ(14,"div",11),A._uU(15),A.ALo(16,"translate"),A.qZA(),A.YNc(17,ia,1,5,"perun-web-apps-resources-list",12),A.qZA()}if(2&e){var a=A.oxw();A.xp6(2),A.Oqu(A.lcZ(3,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),A.xp6(3),A.Q6J("ngIf",null!==a.taskId),A.xp6(1),A.Q6J("ngIf",null!==a.taskId),A.xp6(1),A.s9C("matTooltip",A.lcZ(8,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),A.Q6J("matTooltipDisabled",!a.checkboxesDisabled)("disabled",a.checkboxesDisabled)("checked",a.destinationChecked),A.xp6(2),A.hij(" ",A.lcZ(10,15,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),A.xp6(3),A.Oqu(A.lcZ(13,17,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),A.xp6(3),A.hij(" ",A.lcZ(16,19,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),A.xp6(2),A.Q6J("ngIf",!a.loading)}}var na=function(){var t=function(){function t(i,a,n,l,r,o,c,u){s(this,t),this.dialogRef=i,this.data=a,this.resourcesManager=n,this.tasksManager=l,this.serviceManager=r,this.translate=o,this.notificator=c,this.cd=u,this.loading=!1,this.dataSource=new ot.by(this.data.resource),this.selected=new Le.Ov(!0,e(this.dataSource.data)),this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=Oe.$V}return r(t,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}},{key:"remove",value:function(){var e=this;this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&null!==this.taskId&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(function(t){t.forEach(function(t){e.tasksManager.deleteTaskResultById({taskResultId:t.id}).subscribe()})}),this.taskChecked&&null!==this.taskId&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getDestinations(this.serviceId,this.facilityId).subscribe(function(t){t.forEach(function(t){e.serviceManager.removeDestination(e.serviceId,e.facilityId,t.destination,t.type).subscribe()})}),this.selected.selected.forEach(function(t){e.resourcesManager.removeService(t.id,e.serviceId).subscribe(function(){e.translate.get("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS").subscribe(function(t){e.notificator.showSuccess(t),e.dialogRef.close(!0)})},function(){return e.loading=!1})})}},{key:"cancel",value:function(){this.dialogRef.close(!1)}},{key:"disableCheckboxes",value:function(e){e&&this.checkboxesDisabled&&this.changeCheckboxes(!0),e||this.checkboxesDisabled||this.changeCheckboxes(!1)}},{key:"changeCheckboxes",value:function(e){this.checkboxesDisabled=!e,this.taskChecked=e,this.taskResultsChecked=e,this.destinationChecked=e,this.cd.detectChanges()}},{key:"change",value:function(e){switch(e.source.id){case"task":this.taskChecked=e.checked;break;case"taskResults":this.taskResultsChecked=e.checked;break;case"destination":this.destinationChecked=e.checked}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.xk),A.Y36(f.Ob),A.Y36(f.KK),A.Y36(_.sK),A.Y36(g.V6),A.Y36(A.sBO))},t.\u0275cmp=A.Xpm({type:t,selectors:[["app-delete-service-from-facility"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],["id","task","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","taskResults","class","right-space","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change",4,"ngIf"],["id","destination","color","warn",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[1,"font-weight-bold"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected",4,"ngIf"],["id","task","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],["id","taskResults","color","warn",1,"right-space",3,"matTooltip","matTooltipDisabled","disabled","checked","change"],[3,"tableId","disableRouting","resources","selection","displayedColumns","allSelected"]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,Ki,1,0,"mat-spinner",1),A.YNc(5,aa,18,21,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.cancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.remove()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,9,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),A.xp6(2),A.Q6J("disabled",t.loading||0===t.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," "))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY,ue.oG,E.gM,Wi.C],pipes:[_.X$],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]}),t}();function sa(e,t){1&e&&A._UZ(0,"mat-spinner",6)}function la(e,t){1&e&&(A.TgZ(0,"div",7),A.TgZ(1,"div",8),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.qZA()),2&e&&(A.xp6(2),A.hij(" ",A.lcZ(3,1,"DIALOGS.DELETE_TASK.DESCRIPTION")," "))}var ra=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.tasksManager=a,this.translate=n,this.notificator=l,this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.taskId=this.data.taskId}},{key:"remove",value:function(){var e=this;this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(function(){e.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(function(t){e.notificator.showSuccess(t),e.dialogRef.close(!0)})},function(){return e.loading=!1})}},{key:"cancel",value:function(){this.dialogRef.close(!1)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.Ob),A.Y36(_.sK),A.Y36(g.V6))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-delete-task-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["mat-flat-button","","color","warn",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"div"),A.YNc(4,sa,1,0,"mat-spinner",1),A.YNc(5,la,4,3,"div",2),A.TgZ(6,"div",3),A.TgZ(7,"button",4),A.NdJ("click",function(){return t.cancel()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",5),A.NdJ("click",function(){return t.remove()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,9,"DIALOGS.DELETE_TASK.TITLE")),A.xp6(2),A.Tol(t.theme),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading),A.xp6(3),A.hij(" ",A.lcZ(9,11,"DIALOGS.DELETE_TASK.CANCEL")," "),A.xp6(2),A.Q6J("disabled",t.loading),A.xp6(1),A.hij(" ",A.lcZ(12,13,"DIALOGS.DELETE_TASK.DELETE")," "))},directives:[I.uh,o.O5,I.H8,C.lW,y.$g,I.xY],pipes:[_.X$],styles:[""]}),e}(),oa=l(8055),ca=function(){var e=function(){function e(){s(this,e)}return r(e,[{key:"transform",value:function(e){return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED"}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=A.Yjl({name:"serviceStateBlockedToString",type:e,pure:!0}),e}();function ua(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"th",18),A.TgZ(1,"mat-checkbox",19),A.NdJ("change",function(e){A.CHM(i);var t=A.oxw();return e&&t.masterToggle(),t.selectionChange.emit()}),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function da(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"td",20),A.TgZ(1,"mat-checkbox",21),A.NdJ("click",function(e){return e.stopPropagation()})("change",function(e){var t=A.CHM(i).$implicit,a=A.oxw();return e&&a.selection.toggle(t),a.selectionChange.emit()}),A.qZA(),A.qZA()}if(2&e){var a=t.$implicit,n=A.oxw();A.xp6(1),A.Q6J("checked",n.selection.isSelected(a))("aria-label",n.checkboxLabel(a))}}function ha(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TASK_ID")))}function fa(e,t){if(1&e&&(A.TgZ(0,"div"),A._uU(1),A.qZA()),2&e){var i=A.oxw().$implicit;A.xp6(1),A.Oqu(i.task.id)}}function pa(e,t){1&e&&(A.TgZ(0,"div"),A._uU(1,"0"),A.qZA())}function ga(e,t){if(1&e&&(A.TgZ(0,"td",23),A.YNc(1,fa,2,1,"div",24),A.YNc(2,pa,2,0,"div",24),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Q6J("ngIf",i.task),A.xp6(1),A.Q6J("ngIf",!i.task)}}function ma(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.SERVICE_NAME")))}function va(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.service.name)}}function Aa(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STATUS")))}function Ia(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.status)}}function Sa(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.BLOCKED")))}function Ta(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.ALo(2,"serviceStateBlockedToString"),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(A.lcZ(2,1,i))}}function ya(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STARTED")))}function ba(e,t){if(1&e&&(A.TgZ(0,"div"),A._uU(1),A.ALo(2,"date"),A.qZA()),2&e){var i=A.oxw().$implicit;A.xp6(1),A.Oqu(A.xi3(2,1,i.task.startTime,"d.M.y H:mm:ss"))}}function Ea(e,t){1&e&&(A.TgZ(0,"div"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET"),""))}function Za(e,t){if(1&e&&(A.TgZ(0,"td",25),A.YNc(1,ba,3,4,"div",24),A.YNc(2,Ea,3,3,"div",24),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Q6J("ngIf",i.task&&i.task.startTime),A.xp6(1),A.Q6J("ngIf",!i.task||!i.task.startTime)}}function Ca(e,t){1&e&&(A.TgZ(0,"th",22),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.ENDED")))}function _a(e,t){if(1&e&&(A.TgZ(0,"div"),A._uU(1),A.ALo(2,"date"),A.qZA()),2&e){var i=A.oxw().$implicit;A.xp6(1),A.Oqu(A.xi3(2,1,i.task.endTime,"d.M.y H:mm:ss"))}}function ka(e,t){1&e&&(A.TgZ(0,"div"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function Oa(e,t){if(1&e&&(A.TgZ(0,"td",25),A.YNc(1,_a,3,4,"div",24),A.YNc(2,ka,3,3,"div",24),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Q6J("ngIf",i.task&&i.task.endTime),A.xp6(1),A.Q6J("ngIf",!i.task||!i.task.endTime)}}function La(e,t){1&e&&A._UZ(0,"tr",26)}var xa=function(e,t){return["/facilities",e,"services-status",t]};function Na(e,t){if(1&e&&A._UZ(0,"tr",27),2&e){var i=t.$implicit,a=A.oxw();A.ekj("disable-outline",a.disableRouting||!i.task)("make-yellow","WARNING"===i.status)("make-green","DONE"===i.status)("make-red","GENERROR"===i.status||"SENDERROR"===i.status||"ERROR"===i.status)("cursor-pointer",!a.disableRouting&&null!==i.task),A.Q6J("routerLink",a.disableRouting||null===i.task?null:A.WLB(12,xa,i.facility.id,i.taskId))("perunWebAppsMiddleClickRouterLink",a.disableRouting||null===i.task?null:A.WLB(15,xa,i.facility.id,i.taskId))}}function Ra(e,t){1&e&&(A.TgZ(0,"app-alert",28),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Da(e,t){1&e&&(A.TgZ(0,"app-alert",28),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_SERVICES_STATUS_WARNING"),"\n"))}var wa=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.servicesStatus=[],this.displayedColumns=["select","task.id","service.name","status","blocked","task.startTime","task.endTime"],this.selection=new Le.Ov(!0,[]),this.disableRouting=!0,this.selectionChange=new A.vpe,this.pageSizeOptions=p.f7}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"task.id"!==e})),this.dataSource=new ot.by(this.servicesStatus),this.setDataSource(),this.dataSource.filterPredicate=function(e,t){var i=t.trim().toLowerCase();return function e(t){var i="";return Object.values(t).forEach(function(t){"object"!=typeof t?i=i+" "+t:null!==t&&(i=i+" "+e(t))}),i.trim().toLowerCase()}(e).includes(i)},this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"task.id":return e.task?e.task.id.toString():e[t];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task&&e.task.startTime?(0,o.p6)(e.task.startTime,"d.M.y H:mm:ss","en"):e[t];case"task.endTime":return e.task&&e.task.endTime?(0,o.p6)(e.task.endTime,"d.M.y H:mm:ss","en"):e[t];default:return e[t]}}},{key:"getSortDataForColumn",value:function(e,t){switch(t){case"task.id":return e.task?e.task.id.toString():e[t];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task&&e.task.startTime?(0,o.p6)(e.task.startTime,"yyyy.MM.dd HH:mm:ss","en"):e[t];case"task.endTime":return e.task&&e.task.endTime?(0,o.p6)(e.task.endTime,"yyyy.MM.dd HH:mm:ss","en"):e[t];default:return e[t]}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getSortDataForColumn,e)},this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.service.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.UA))},e.\u0275cmp=A.Xpm({type:e,selectors:[["perun-web-apps-services-status-list"]],viewQuery:function(e,t){var i;(1&e&&(A.Gf(Dt.YE,7),A.Gf(p.l9,7)),2&e)&&(A.iGM(i=A.CRH())&&(t.matSort=i.first),A.iGM(i=A.CRH())&&(t.child=i.first))},inputs:{servicesStatus:"servicesStatus",displayedColumns:"displayedColumns",selection:"selection",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting"},outputs:{selectionChange:"selectionChange"},features:[A.TTD],decls:28,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","service.name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size align-checkbox",4,"matCellDef"],["matColumnDef","task.id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size",4,"matCellDef"],["matColumnDef","service.name"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","blocked"],["matColumnDef","task.startTime"],["matColumnDef","task.endTime"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","dark-hover-list-item",3,"disable-outline","make-yellow","make-green","make-red","cursor-pointer","routerLink","perunWebAppsMiddleClickRouterLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngIf"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"routerLink","perunWebAppsMiddleClickRouterLink"],["alert_type","warn"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"perun-web-apps-table-wrapper",1),A.NdJ("exportData",function(e){return t.exportData(e)}),A.TgZ(2,"table",2),A.ynx(3,3),A.YNc(4,ua,2,3,"th",4),A.YNc(5,da,2,2,"td",5),A.BQk(),A.ynx(6,6),A.YNc(7,ha,3,3,"th",7),A.YNc(8,ga,3,2,"td",8),A.BQk(),A.ynx(9,9),A.YNc(10,ma,3,3,"th",7),A.YNc(11,va,2,1,"td",10),A.BQk(),A.ynx(12,11),A.YNc(13,Aa,3,3,"th",7),A.YNc(14,Ia,2,1,"td",10),A.BQk(),A.ynx(15,12),A.YNc(16,Sa,3,3,"th",7),A.YNc(17,Ta,3,3,"td",10),A.BQk(),A.ynx(18,13),A.YNc(19,ya,3,3,"th",7),A.YNc(20,Za,3,2,"td",10),A.BQk(),A.ynx(21,14),A.YNc(22,Ca,3,3,"th",7),A.YNc(23,Oa,3,2,"td",10),A.BQk(),A.YNc(24,La,1,0,"tr",15),A.YNc(25,Na,1,18,"tr",16),A.qZA(),A.qZA(),A.qZA(),A.YNc(26,Ra,3,3,"app-alert",17),A.YNc(27,Da,3,3,"app-alert",17)),2&e&&(A.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.servicesStatus.length),A.xp6(1),A.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),A.xp6(1),A.Q6J("dataSource",t.dataSource),A.xp6(22),A.Q6J("matHeaderRowDef",t.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",t.displayedColumns),A.xp6(1),A.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.servicesStatus.length),A.xp6(1),A.Q6J("ngIf",0===t.servicesStatus.length))},directives:[wt.l,ot.BZ,Dt.YE,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,o.O5,ot.ge,ue.oG,ot.ev,Dt.nU,ot.XQ,ot.Gk,c.rH,Tt.YH,je.w],pipes:[_.X$,ca,o.uU],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.make-green[_ngcontent-%COMP%]{background-color:#c4ffcb}.make-yellow[_ngcontent-%COMP%]{background-color:#fffde7}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),e}();function Fa(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",11),A.NdJ("click",function(){return A.CHM(i),A.oxw().forcePropagation()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function Ya(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",11),A.NdJ("click",function(){return A.CHM(i),A.oxw().allow()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length||a.disableAllowButton),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function Ua(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",12),A.NdJ("click",function(){return A.CHM(i),A.oxw().block()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selected.selected.length||a.disableBlockButton),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function qa(e,t){if(1&e&&(A.TgZ(0,"button",13),A.ALo(1,"translate"),A._uU(2),A.ALo(3,"translate"),A.qZA()),2&e){var i=A.oxw(),a=A.MAs(10);A.s9C("matTooltip",A.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),A.Q6J("matTooltipDisabled",!i.disableRemoveButton)("disabled",i.disableRemoveButton)("matMenuTriggerFor",a),A.xp6(2),A.hij(" ",A.lcZ(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function Ma(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",7),A.NdJ("click",function(){return A.CHM(i),A.oxw().removeTaskResults()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Ja(e,t){1&e&&A._UZ(0,"mat-spinner",14)}function Qa(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"perun-web-apps-services-status-list",15),A.NdJ("selectionChange",function(){return A.CHM(i),A.oxw().selectionChanged()}),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("tableId",a.tableId)("filterValue",a.filterValue)("servicesStatus",a.servicesStates)("selection",a.selected)("disableRouting",!a.routeAuth)}}var Va=function(){var e=function(){function e(t,i,a,n,l,r,o,c,u){var d=this;s(this,e),this.tasksManager=t,this.servicesManager=i,this.notificator=a,this.translate=n,this.authResolver=l,this.facilityManager=r,this.resourcesManager=o,this.dialog=c,this.entityStorageService=u,this.servicesStates=[],this.selected=new Le.Ov(!0,[]),this.filterValue="",this.tableId=Oe.oK,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION").subscribe(function(e){return d.successFPMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW").subscribe(function(e){return d.successAllowMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK").subscribe(function(e){return d.successBlockMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_DELETE").subscribe(function(e){return d.successDeleteMessage=e}),n.get("FACILITY_DETAIL.SERVICES_STATUS.ALREADY_DELETED").subscribe(function(e){return d.allreadyDeletedMessage=e})}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}},{key:"forcePropagation",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.forceServicePropagation(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successFPMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"allow",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.unblockServiceOnFacility(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successAllowMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"block",value:function(){var e,t=this,a=i(this.selected.selected);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.servicesManager.blockServiceOnFacility(n.service.id,n.facility.id).subscribe(function(){t.refreshTable(),t.notificator.showSuccess(t.successBlockMessage)})}}catch(s){a.e(s)}finally{a.f()}}},{key:"removeTaskResults",value:function(){var e=this;this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(function(t){var i=(0,p.kZ)();i.width="600px",i.data={theme:"facility-theme",taskResults:t},e.dialog.open(Xi,i)})}},{key:"removeServiceFromFacility",value:function(){var e=this;this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe(function(t){var i=(0,p.kZ)();i.width="600px",e.taskId=e.taskIsNull?null:e.selected.selected[0].task.id,0===t.length?(i.data={theme:"facility-theme",taskId:e.taskId},e.dialog.open(ra,i).afterClosed().subscribe(function(t){t&&(e.disableRemoveButton=!0,e.refreshTable())})):e.resourcesManager.getRichResourcesByIds(t.map(function(e){return e.id})).subscribe(function(t){i.data={theme:"facility-theme",taskId:e.taskId,serviceId:e.selected.selected[0].service.id,facilityId:e.selected.selected[0].facility.id,resource:t},e.dialog.open(na,i).afterClosed().subscribe(function(t){t&&(e.disableRemoveButton=!0,e.refreshTable())})})})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(function(t){e.servicesStates=t,e.selected.clear(),e.setAuthRights(),e.loading=!1})}},{key:"setAuthRights",value:function(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"selectionChanged",value:function(){this.disableBlockButton=!0,this.disableAllowButton=!0,this.disableRemoveButton=1!==this.selected.selected.length,this.disableRemoveButton||(this.taskIsNull=null===this.selected.selected[0].task);var e,t=i(this.selected.selected);try{for(t.s();!(e=t.n()).done;){e.value.blockedOnFacility?this.disableAllowButton=!1:this.disableBlockButton=!1}}catch(a){t.e(a)}finally{t.f()}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.Ob),A.Y36(f.KK),A.Y36(g.V6),A.Y36(_.sK),A.Y36(g.x4),A.Y36(f.IQ),A.Y36(f.xk),A.Y36(I.uw),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-service-status"]],decls:18,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["mat-flat-button","","color","accent","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2",3,"disabled","click",4,"ngIf"],["mat-flat-button","","color","warn","class","mr-2 dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange",4,"ngIf"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2","dropdown-toggle",3,"matTooltip","matTooltipDisabled","disabled","matMenuTriggerFor"],[1,"ml-auto","mr-auto"],[3,"tableId","filterValue","servicesStatus","selection","disableRouting","selectionChange"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"perun-web-apps-refresh-button",1),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.YNc(5,Fa,3,4,"button",2),A.YNc(6,Ya,3,4,"button",2),A.YNc(7,Ua,3,4,"button",3),A.YNc(8,qa,4,9,"button",4),A.TgZ(9,"mat-menu",null,5),A.YNc(11,Ma,3,3,"button",6),A.TgZ(12,"button",7),A.NdJ("click",function(){return t.removeServiceFromFacility()}),A._uU(13),A.ALo(14,"translate"),A.qZA(),A.qZA(),A.TgZ(15,"perun-web-apps-immediate-filter",8),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(16,Ja,1,0,"mat-spinner",9),A.YNc(17,Qa,1,5,"perun-web-apps-services-status-list",10),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),A.xp6(3),A.Q6J("ngIf",t.propagationAuth),A.xp6(1),A.Q6J("ngIf",t.allowAuth),A.xp6(1),A.Q6J("ngIf",t.blockAuth),A.xp6(1),A.Q6J("ngIf",t.deleteAuth),A.xp6(3),A.Q6J("ngIf",!t.taskIsNull),A.xp6(2),A.Oqu(A.lcZ(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")),A.xp6(2),A.Q6J("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,o.O5,oa.VK,oa.OP,Be.L,C.lW,E.gM,oa.p6,y.$g,wa],pipes:[_.X$],styles:[""]}),e}(),Ha=l(67004),Pa=l(91058),Ga=function(){var e=function(){function e(){s(this,e),this.changeAdvancedFilter=new A.vpe,this.clearFilters=new A.vpe}return r(e,[{key:"ngOnInit",value:function(){this.changeAdvancedFilter.emit(this.advancedFilter)}},{key:"toggleAdvancedFilter",value:function(){this.advancedFilter=!this.advancedFilter,this.changeAdvancedFilter.emit(this.advancedFilter)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=A.Xpm({type:e,selectors:[["perun-web-apps-advanced-filter"]],inputs:{filtersCount:"filtersCount",advancedFilter:"advancedFilter"},outputs:{changeAdvancedFilter:"changeAdvancedFilter",clearFilters:"clearFilters"},decls:12,vars:11,consts:[["mat-stroked-button","",3,"click"]],template:function(e,t){1&e&&(A.TgZ(0,"button",0),A.NdJ("click",function(){return t.toggleAdvancedFilter()}),A.TgZ(1,"mat-icon"),A._uU(2,"filter_list"),A.qZA(),A._uU(3),A.ALo(4,"translate"),A.TgZ(5,"mat-icon"),A._uU(6),A.qZA(),A.qZA(),A.TgZ(7,"button",0),A.NdJ("click",function(){return t.clearFilters.emit()}),A.TgZ(8,"mat-icon"),A._uU(9,"filter_list_off"),A.qZA(),A._uU(10),A.ALo(11,"translate"),A.qZA()),2&e&&(A.Gre("mr-2 ",t.filtersCount?"grey":"no-color",""),A.xp6(3),A.AsE(" ",A.lcZ(4,7,"SHARED_LIB.PERUN.COMPONENTS.ADVANCED_FILTER.FILTERS")," ",t.filtersCount?"("+t.filtersCount+")":null," "),A.xp6(3),A.Oqu(t.advancedFilter?"arrow_drop_up":"arrow_drop_down"),A.xp6(4),A.hij(" ",A.lcZ(11,9,"SHARED_LIB.PERUN.COMPONENTS.ADVANCED_FILTER.CLEAR_FILTERS"),"\n"))},directives:[C.lW,b.Hw],pipes:[_.X$],styles:[".grey[_ngcontent-%COMP%]{color:#fff;background-color:grey}.no-color[_ngcontent-%COMP%]{color:#000;background-color:transparent}"]}),e}(),Ba=l(27521),ja=l(19386),$a=l(42847),za=l(44973),Xa=function(){var e=function e(){s(this,e),this.service=null,this.multiple=!1,this.disableAutoSelect=!1,this.theme="",this.serviceSelected=new A.vpe,this.nameFunction=function(e){return e.name},this.secondaryFunction=function(){return""},this.searchFunction=function(e){return e.name}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=A.Xpm({type:e,selectors:[["perun-web-apps-service-search-select"]],inputs:{service:"service",services:"services",multiple:"multiple",disableAutoSelect:"disableAutoSelect",theme:"theme"},outputs:{serviceSelected:"serviceSelected"},decls:4,vars:17,consts:[[3,"entity","entities","multiple","disableAutoSelect","searchFunction","mainTextFunction","secondaryTextFunction","selectPlaceholder","findPlaceholder","noEntriesText","theme","entitySelected"]],template:function(e,t){1&e&&(A.TgZ(0,"perun-web-apps-entity-search-select",0),A.NdJ("entitySelected",function(e){return t.serviceSelected.emit(e)}),A.ALo(1,"translate"),A.ALo(2,"translate"),A.ALo(3,"translate"),A.qZA()),2&e&&A.Q6J("entity",t.service)("entities",t.services)("multiple",t.multiple)("disableAutoSelect",t.disableAutoSelect)("searchFunction",t.searchFunction)("mainTextFunction",t.nameFunction)("secondaryTextFunction",t.secondaryFunction)("selectPlaceholder",A.lcZ(1,11,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.SELECT_SERVICE"))("findPlaceholder",A.lcZ(2,13,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.FIND_SERVICE"))("noEntriesText",A.lcZ(3,15,"SHARED_LIB.PERUN.COMPONENTS.SERVICE_SEARCH_SELECT.NO_SERVICE_FOUND"))("theme",t.theme)},directives:[za.i],pipes:[_.X$],styles:[""]}),e}(),Wa=l(16247);function Ka(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div",8),A.TgZ(1,"div",9),A.TgZ(2,"mat-slide-toggle",10),A.NdJ("ngModelChange",function(e){return A.CHM(i),A.oxw().allowed=e})("change",function(){return A.CHM(i),A.oxw().changeFilter()}),A._uU(3),A.ALo(4,"translate"),A.qZA(),A.TgZ(5,"span",11),A._uU(6),A.ALo(7,"translate"),A.qZA(),A.qZA(),A.TgZ(8,"div",1),A.TgZ(9,"perun-web-apps-vo-search-select",12),A.NdJ("voSelected",function(e){return A.CHM(i),A.oxw().voSelected(e)}),A.qZA(),A.TgZ(10,"perun-web-apps-resource-search-select",13),A.NdJ("resourceSelected",function(e){return A.CHM(i),A.oxw().resourceSelected(e)}),A.qZA(),A.TgZ(11,"perun-web-apps-service-search-select",14),A.NdJ("serviceSelected",function(e){return A.CHM(i),A.oxw().serviceSelected(e)}),A.qZA(),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(2),A.Q6J("ngModel",a.allowed),A.xp6(1),A.hij(" ",A.lcZ(4,10,"FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED")," "),A.xp6(3),A.Oqu(A.lcZ(7,12,a.toggle_messages[a.allowed?1:0])),A.xp6(3),A.Q6J("vo",a.selectedVo)("vos",a.vos),A.xp6(1),A.Q6J("displayStatus",!1)("resource",a.selectedResource)("resources",a.filteredResources),A.xp6(1),A.Q6J("service",a.selectedService)("services",a.filteredServices)}}function en(e,t){1&e&&A._UZ(0,"mat-spinner",15)}var tn=function(){return["id","name","email","logins","organization"]};function an(e,t){if(1&e&&A._UZ(0,"perun-web-apps-users-dynamic-list",16),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("searchString",i.filterValue)("displayedColumns",A.DdM(10,tn))("attrNames",i.attributes)("facilityId",i.facility.id)("voId",-1===i.selectedVo.id?null:i.selectedVo.id)("resourceId",-1===i.selectedResource.id?null:i.selectedResource.id)("serviceId",-1===i.selectedService.id?null:i.selectedService.id)("onlyAllowed",i.allowed)("disableRouting",!i.routeAuth)}}var nn=function(){var e=function(){function e(t,i,a,n,l,r){s(this,e),this.facilityService=t,this.serviceService=i,this.resourceService=a,this.authResolver=n,this.storeService=l,this.entityStorageService=r,this.loading=!1,this.filterValue="",this.attributes=[],this.allowed=!0,this.emptyResource={id:-1,beanName:"Resource",name:"No filter"},this.resources=[this.emptyResource],this.filteredResources=[this.emptyResource],this.selectedResource=this.emptyResource,this.emptyVo={id:-1,beanName:"Vo",name:"No filter"},this.vos=[this.emptyVo],this.selectedVo=this.emptyVo,this.emptyService={id:-1,beanName:"Service",name:"No filter"},this.services=[this.emptyService],this.filteredServices=[this.emptyService],this.selectedService=this.emptyService,this.resourceAssignedServices=new Map,this.tableId=Oe.z6,this.toggle_messages=["FACILITY_DETAIL.ALLOWED_USERS.FILTER_ASSIGNED_MSG","FACILITY_DETAIL.ALLOWED_USERS.FILTER_ALLOWED_MSG"],this.advancedFilter=!1}return r(e,[{key:"ngOnInit",value:function(){this.loading=!0,this.attributes=[Ha.r.USER_DEF_ORGANIZATION,Ha.r.USER_DEF_PREFERRED_MAIL],this.attributes=this.attributes.concat(this.storeService.getLoginAttributeNames()),this.facility=this.entityStorageService.getEntity(),this.routeAuth=this.authResolver.isPerunAdminOrObserver(),this.changeFilter(),this.refreshPage()}},{key:"changeFilter",value:function(){this.filtersCount=this.allowed?1:0,-1!==this.selectedVo.id&&(this.filtersCount+=1),-1!==this.selectedResource.id&&(this.filtersCount+=1),-1!==this.selectedService.id&&(this.filtersCount+=1)}},{key:"clearFilters",value:function(){this.allowed=!1,this.selectedVo=this.emptyVo,this.selectedResource=this.emptyResource,this.selectedService=this.emptyService,this.filtersCount=0}},{key:"refreshPage",value:function(){var e=this;this.loading=!0,this.facilityService.getAssignedResourcesForFacility(this.facility.id).subscribe(function(t){e.resources=[e.emptyResource].concat(t),e.filteredResources=e.resources,e.selectedResource=e.emptyResource,e.facilityService.getAllowedVos(e.facility.id).subscribe(function(t){e.vos=[e.emptyVo].concat(t),e.selectedVo=e.emptyVo,e.services=[],e.getAssignedServices(e.resources,e.resources.length-1)},function(){return e.loading=!1})},function(){return e.loading=!1})}},{key:"getAssignedServices",value:function(e,t){var i=this;if(0===t)return this.services=[this.emptyService].concat(this.services),this.filteredServices=this.services,this.selectedService=this.emptyService,this.changeFilter(),void(this.loading=!1);this.resourceService.getAssignedServicesToResource(e[t].id).subscribe(function(a){i.services=i.services.concat(a),i.resourceAssignedServices[e[t].id]=a.map(function(e){return e.id}),i.getAssignedServices(e,t-1)},function(){return i.loading=!1})}},{key:"getFilteredServices",value:function(e){var t=this,i=new Set;return e.forEach(function(e){t.resourceAssignedServices[e.id].forEach(function(e){return i.add(e)})}),[this.emptyService].concat(this.services.filter(function(e){return i.has(e.id)}))}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"voSelected",value:function(e){this.selectedVo.id!==e.id&&(this.selectedVo=e,this.selectedResource=this.emptyResource,this.selectedService=this.emptyService,-1===e.id?(this.filteredResources=this.resources,this.filteredServices=this.services):(this.filteredResources=this.resources.filter(function(t){return t.voId===e.id}),this.filteredServices=this.getFilteredServices(this.filteredResources),this.filteredResources=[this.emptyResource].concat(this.filteredResources)),this.changeFilter())}},{key:"resourceSelected",value:function(e){this.selectedResource.id!==e.id&&(this.selectedResource=e,this.selectedService=this.emptyService,this.filteredServices=-1===e.id?this.services:this.getFilteredServices([e]),this.changeFilter())}},{key:"serviceSelected",value:function(e){this.selectedService=e,this.changeFilter()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(f.IQ),A.Y36(f.KK),A.Y36(f.xk),A.Y36(g.x4),A.Y36(g.d6),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-allowed-users"]],decls:11,vars:9,consts:[[1,"page-subtitle"],[1,"filters"],[1,"mr-2",3,"refresh"],[1,"mr-2","filter",3,"placeholder","filter"],[3,"filtersCount","advancedFilter","changeAdvancedFilter","clearFilters"],["class","advanced-filter",4,"ngIf"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting",4,"ngIf"],[1,"advanced-filter"],[1,"toggle","filters"],["labelPosition","before",1,"mr-2",3,"ngModel","ngModelChange","change"],[1,"text-muted"],[1,"search-select",3,"vo","vos","voSelected"],[1,"search-select",3,"displayStatus","resource","resources","resourceSelected"],[1,"search-select",3,"service","services","serviceSelected"],[1,"ml-auto","mr-auto"],[3,"tableId","searchString","displayedColumns","attrNames","facilityId","voId","resourceId","serviceId","onlyAllowed","disableRouting"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",1),A.TgZ(5,"perun-web-apps-refresh-button",2),A.NdJ("refresh",function(){return t.refreshPage()}),A.qZA(),A.TgZ(6,"perun-web-apps-debounce-filter",3),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.TgZ(7,"perun-web-apps-advanced-filter",4),A.NdJ("changeAdvancedFilter",function(e){return t.advancedFilter=e})("clearFilters",function(){return t.clearFilters()}),A.qZA(),A.qZA(),A.YNc(8,Ka,12,14,"div",5),A.YNc(9,en,1,0,"mat-spinner",6),A.YNc(10,an,1,11,"perun-web-apps-users-dynamic-list",7),A.qZA()),2&e&&(A.xp6(2),A.Oqu(A.lcZ(3,7,"FACILITY_DETAIL.ALLOWED_USERS.TITLE")),A.xp6(4),A.Q6J("placeholder","FACILITY_DETAIL.ALLOWED_USERS.FILTER"),A.xp6(1),A.Q6J("filtersCount",t.filtersCount)("advancedFilter",t.advancedFilter),A.xp6(1),A.Q6J("ngIf",t.advancedFilter),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,Pa.P,Ga,o.O5,Ba.Rr,le.JJ,le.On,ja.M,$a.L,Xa,y.$g,Wa.M],pipes:[_.X$],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.filter[_ngcontent-%COMP%]{min-width:350px}.search-select[_ngcontent-%COMP%]{width:32%;margin-right:20px;margin-top:30px}.toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column}.advanced-filter[_ngcontent-%COMP%]{border:1px solid #d3d3d3;padding:15px}"]}),e}(),sn=l(95142);function ln(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"th",20),A.TgZ(1,"mat-checkbox",21),A.NdJ("change",function(e){A.CHM(i);var t=A.oxw();return e?t.masterToggle():null}),A.qZA(),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Q6J("aria-label",a.checkboxLabel())("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())}}function rn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"td",22),A.TgZ(1,"mat-checkbox",23),A.NdJ("change",function(e){var t=A.CHM(i).$implicit,a=A.oxw();return e?a.selection.toggle(t):null})("click",function(e){return e.stopPropagation()}),A.qZA(),A.qZA()}if(2&e){var a=t.$implicit,n=A.oxw();A.xp6(1),A.Q6J("aria-label",n.checkboxLabel(a))("checked",n.selection.isSelected(a))}}function on(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RESULT_ID")))}function cn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.id)}}function un(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.DESTINATION")))}function dn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.destination.destination)}}function hn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TYPE")))}function fn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.destination.type.toUpperCase())}}function pn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.SERVICE")))}function gn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.service.name)}}function mn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STATUS")))}function vn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.status)}}function An(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TIME")))}function In(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.ALo(2,"date"),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(A.xi3(2,1,i.timestamp,"d.M.y H:mm:ss"))}}function Sn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RETURN_CODE")))}function Tn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.returnCode)}}function yn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STANDARD_MESSAGE")))}function bn(e,t){if(1&e&&(A.TgZ(0,"span"),A._uU(1),A._UZ(2,"br"),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i)}}function En(e,t){if(1&e&&(A.TgZ(0,"td",25),A.YNc(1,bn,3,1,"span",26),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Q6J("ngForOf",i.standardMessage.split("\n"))}}function Zn(e,t){1&e&&(A.TgZ(0,"th",24),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.Oqu(A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.ERROR_MESSAGE")))}function Cn(e,t){if(1&e&&(A.TgZ(0,"td",25),A._uU(1),A.qZA()),2&e){var i=t.$implicit;A.xp6(1),A.Oqu(i.errorMessage)}}function _n(e,t){1&e&&A._UZ(0,"tr",27)}function kn(e,t){if(1&e&&A._UZ(0,"tr",28),2&e){var i=t.$implicit;A.ekj("greenTableItem","DONE"===i.status)("redTableItem","ERROR"===i.status||"DENIED"===i.status)("yellowTableItem","WARNING"===i.status)}}function On(e,t){1&e&&(A.TgZ(0,"app-alert",29),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ln(e,t){1&e&&(A.TgZ(0,"app-alert",29),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.NO_RESULTS_WARNING"),"\n"))}var xn=function(){var e=function(){function e(t,i){s(this,e),this.authResolver=t,this.tableCheckbox=i,this.pageSizeOptions=p.f7,this.taskResults=[],this.selection=new Le.Ov(!0,[]),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]}return r(e,[{key:"matSort",set:function(e){this.sort=e,this.setDataSource()}},{key:"ngOnChanges",value:function(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(function(e){return"id"!==e})),this.dataSource=new ot.by(this.taskResults),this.setDataSource(),this.dataSource.filter=this.filterValue}},{key:"getDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,o.p6)(e.timestamp.toString(),"d.M.y H:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}},{key:"getSortDataForColumn",value:function(e,t){switch(t){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,o.p6)(e.timestamp.toString(),"yyyy.MM.dd HH:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}},{key:"exportData",value:function(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,this.getDataForColumn,this),e)}},{key:"setDataSource",value:function(){var e=this;this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue,this.dataSource.filterPredicate=function(t,i){return(0,p.Sd)(t,i,e.displayedColumns,e.getDataForColumn,e)},this.dataSource.sortData=function(t,i){return(0,p.pR)(t,i,e.getSortDataForColumn,e)})}},{key:"isAllSelected",value:function(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.filterValue,this.child.paginator.pageSize,this.child.paginator.hasNextPage(),this.dataSource)}},{key:"masterToggle",value:function(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}},{key:"checkboxLabel",value:function(e){return e?"".concat(this.selection.isSelected(e)?"deselect":"select"," row ").concat(e.id+1):(this.isAllSelected()?"select":"deselect")+" all"}},{key:"ngAfterViewInit",value:function(){this.dataSource.paginator=this.child.paginator}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(g.x4),A.Y36(g.UA))},e.\u0275cmp=A.Xpm({type:e,selectors:[["perun-web-apps-task-results-list"]],viewQuery:function(e,t){var i;(1&e&&(A.Gf(Dt.YE,7),A.Gf(p.l9,7)),2&e)&&(A.iGM(i=A.CRH())&&(t.matSort=i.first),A.iGM(i=A.CRH())&&(t.child=i.first))},inputs:{taskResults:"taskResults",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[A.TTD],decls:37,vars:9,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportData"],["mat-table","","matSort","","matSortActive","time","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","time"],["matColumnDef","returnCode"],["matColumnDef","standardMessage"],["matColumnDef","errorMessage"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"greenTableItem","redTableItem","yellowTableItem",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,t){1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"perun-web-apps-table-wrapper",1),A.NdJ("exportData",function(e){return t.exportData(e)}),A.TgZ(2,"table",2),A.ynx(3,3),A.YNc(4,ln,2,3,"th",4),A.YNc(5,rn,2,2,"td",5),A.BQk(),A.ynx(6,6),A.YNc(7,on,3,3,"th",7),A.YNc(8,cn,2,1,"td",8),A.BQk(),A.ynx(9,9),A.YNc(10,un,3,3,"th",7),A.YNc(11,dn,2,1,"td",8),A.BQk(),A.ynx(12,10),A.YNc(13,hn,3,3,"th",7),A.YNc(14,fn,2,1,"td",8),A.BQk(),A.ynx(15,11),A.YNc(16,pn,3,3,"th",7),A.YNc(17,gn,2,1,"td",8),A.BQk(),A.ynx(18,12),A.YNc(19,mn,3,3,"th",7),A.YNc(20,vn,2,1,"td",8),A.BQk(),A.ynx(21,13),A.YNc(22,An,3,3,"th",7),A.YNc(23,In,3,4,"td",8),A.BQk(),A.ynx(24,14),A.YNc(25,Sn,3,3,"th",7),A.YNc(26,Tn,2,1,"td",8),A.BQk(),A.ynx(27,15),A.YNc(28,yn,3,3,"th",7),A.YNc(29,En,2,1,"td",8),A.BQk(),A.ynx(30,16),A.YNc(31,Zn,3,3,"th",7),A.YNc(32,Cn,2,1,"td",8),A.BQk(),A.YNc(33,_n,1,0,"tr",17),A.YNc(34,kn,1,6,"tr",18),A.qZA(),A.qZA(),A.qZA(),A.YNc(35,On,3,3,"app-alert",19),A.YNc(36,Ln,3,3,"app-alert",19)),2&e&&(A.Q6J("hidden",0===t.dataSource.filteredData.length||0===t.taskResults.length),A.xp6(1),A.Q6J("tableId",t.tableId)("dataLength",t.dataSource.filteredData.length)("pageSizeOptions",t.pageSizeOptions),A.xp6(1),A.Q6J("dataSource",t.dataSource),A.xp6(31),A.Q6J("matHeaderRowDef",t.displayedColumns),A.xp6(1),A.Q6J("matRowDefColumns",t.displayedColumns),A.xp6(1),A.Q6J("ngIf",0===t.dataSource.filteredData.length&&0!==t.taskResults.length),A.xp6(1),A.Q6J("ngIf",0===t.taskResults.length))},directives:[wt.l,ot.BZ,Dt.YE,ot.w1,ot.fO,ot.Dz,ot.as,ot.nj,o.O5,ot.ge,ue.oG,ot.ev,Dt.nU,o.sg,ot.XQ,ot.Gk,je.w],pipes:[_.X$,o.uU],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}"]}),e}();function Nn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",7),A.NdJ("click",function(){return A.CHM(i),A.oxw().removeTaskResult()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("disabled",0===a.selection.selected.length),A.xp6(1),A.hij(" ",A.lcZ(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),"\n")}}function Rn(e,t){1&e&&A._UZ(0,"mat-spinner",8)}function Dn(e,t){if(1&e&&A._UZ(0,"perun-web-apps-task-results-list",9),2&e){var i=A.oxw();A.Q6J("tableId",i.tableId)("displayedColumns",i.displayedColumns)("filterValue",i.filterValue)("selection",i.selection)("taskResults",i.taskResults)}}var wn=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.route=t,this.taskManager=i,this.authResolver=a,this.dialog=n,this.entityStorageService=l,this.loading=!1,this.filterValue="",this.selection=new Le.Ov(!0,[]),this.task={id:0},this.tableId=Oe.e5,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}return r(e,[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(function(t){e.taskId=t.taskId,e.taskManager.getTaskById(e.taskId).subscribe(function(t){e.task=t,e.refreshTable()})})}},{key:"refreshTable",value:function(){var e=this;this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(function(t){e.selection.clear(),e.taskResults=t,e.loading=!1})}},{key:"removeTaskResult",value:function(){var e=this,t=(0,p.kZ)();t.width="600px",t.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(Xi,t).afterClosed().subscribe(function(t){t&&e.refreshTable()})}},{key:"applyFilter",value:function(e){this.filterValue=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(c.gz),A.Y36(f.Ob),A.Y36(g.x4),A.Y36(I.uw),A.Y36(g.fb))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-facility-task-results"]],decls:10,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","displayedColumns","filterValue","selection","taskResults",4,"ngIf"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","displayedColumns","filterValue","selection","taskResults"]],template:function(e,t){1&e&&(A.TgZ(0,"h1",0),A._uU(1),A.ALo(2,"translate"),A.TgZ(3,"span",1),A._uU(4),A.qZA(),A.qZA(),A.TgZ(5,"perun-web-apps-refresh-button",2),A.NdJ("refresh",function(){return t.refreshTable()}),A.qZA(),A.YNc(6,Nn,3,4,"button",3),A.TgZ(7,"perun-web-apps-immediate-filter",4),A.NdJ("filter",function(e){return t.applyFilter(e)}),A.qZA(),A.YNc(8,Rn,1,0,"mat-spinner",5),A.YNc(9,Dn,1,5,"perun-web-apps-task-results-list",6)),2&e&&(A.xp6(1),A.AsE("",A.lcZ(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",t.task.service?t.task.service.name:""," "),A.xp6(3),A.hij(" \xa0#",t.task.id," "),A.xp6(2),A.Q6J("ngIf",t.removeAuth),A.xp6(1),A.Q6J("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),A.xp6(1),A.Q6J("ngIf",t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[Ge.t,o.O5,Be.L,C.lW,y.$g,xn],pipes:[_.X$],styles:[""]}),e}(),Fn=l(53134),Yn=function(){var e=function(){function e(t,i){s(this,e),this.dialogRef=t,this.data=i,this.theme=""}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"onSkip",value:function(){this.dialogRef.close(!0)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",1),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.TgZ(7,"div",2),A.TgZ(8,"button",3),A.NdJ("click",function(){return t.onCancel()}),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.TgZ(11,"button",4),A.NdJ("click",function(){return t.onSkip()}),A._uU(12),A.ALo(13,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.Tol(t.theme),A.xp6(2),A.Oqu(A.lcZ(3,7,"DIALOGS.NO_SERVICE.TITLE")),A.xp6(3),A.hij(" ",A.lcZ(6,9,"DIALOGS.NO_SERVICE.INFO")," "),A.xp6(4),A.hij(" ",A.lcZ(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),A.xp6(3),A.hij(" ",A.lcZ(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},directives:[I.uh,I.xY,I.H8,C.lW],pipes:[_.X$],styles:[""]}),e}(),Un=function(){var e=function(){function e(t,i){s(this,e),this.dialogRef=t,this.data=i,this.theme=""}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"onSkip",value:function(){this.dialogRef.close(!0)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"div",1),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.TgZ(7,"div",2),A.TgZ(8,"button",3),A.NdJ("click",function(){return t.onCancel()}),A._uU(9),A.ALo(10,"translate"),A.qZA(),A.TgZ(11,"button",4),A.NdJ("click",function(){return t.onSkip()}),A._uU(12),A.ALo(13,"translate"),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.Tol(t.theme),A.xp6(2),A.Oqu(A.lcZ(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),A.xp6(3),A.hij(" ",A.lcZ(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),A.xp6(4),A.hij(" ",A.lcZ(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),A.xp6(3),A.hij(" ",A.lcZ(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},directives:[I.uh,I.xY,I.H8,C.lW],pipes:[_.X$],styles:[""]}),e}();function qn(e,t){if(1&e&&(A.TgZ(0,"div",3),A._UZ(1,"i",4),A.ALo(2,"translate"),A.qZA()),2&e){var i=A.oxw();A.xp6(1),A.Q6J("innerHTML",A.lcZ(2,1,i.info),A.oJD)}}function Mn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",9),A.NdJ("click",function(){return A.CHM(i),A.oxw(2).onKeep()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function Jn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"div",5),A.TgZ(1,"button",6),A.NdJ("click",function(){return A.CHM(i),A.oxw().onCancel()}),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"button",7),A.NdJ("click",function(){return A.CHM(i),A.oxw().onDelete()}),A.TgZ(5,"mat-icon"),A._uU(6," warning "),A.qZA(),A._uU(7),A.ALo(8,"translate"),A.qZA(),A.YNc(9,Mn,3,3,"button",8),A.qZA()}if(2&e){var a=A.oxw();A.xp6(2),A.hij(" ",A.lcZ(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),A.xp6(5),A.hij(" ",A.lcZ(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),A.xp6(2),A.Q6J("ngIf",!a.lastStep)}}var Qn=function(){var e=function(){function e(t,i,a,n,l){s(this,e),this.dialogRef=t,this.data=i,this.facilityService=a,this.notificator=n,this.translate=l,this.theme="",this.title="",this.info="",this.loading=!1}return r(e,[{key:"ngOnInit",value:function(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}},{key:"onCancel",value:function(){this.dialogRef.close(!1)}},{key:"onDelete",value:function(){var e=this;this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(function(){e.notificator.showSuccess(e.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),e.dialogRef.close(!0),e.loading=!1},function(){return e.loading=!1})}},{key:"onKeep",value:function(){this.dialogRef.close(!0)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.Y36(I.so),A.Y36(I.WI),A.Y36(f.IQ),A.Y36(g.V6),A.Y36(_.sK))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-flat-button","",1,"mr-2",3,"click"],["color","warn","mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,t){1&e&&(A.TgZ(0,"div"),A.TgZ(1,"h1",0),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.YNc(4,qn,3,3,"div",1),A.YNc(5,Jn,10,7,"div",2),A.qZA()),2&e&&(A.Tol(t.theme),A.xp6(2),A.Oqu(A.lcZ(3,6,t.title)),A.xp6(2),A.Q6J("ngIf",!t.loading),A.xp6(1),A.Q6J("ngIf",!t.loading))},directives:[I.uh,o.O5,I.xY,I.H8,C.lW,b.Hw],pipes:[_.X$],styles:[""]}),e}(),Vn=l(98470),Hn=l(70663),Pn=l(65267),Gn=l(91721),Bn=l(45001),jn=["stepper"];function $n(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function zn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"app-facility-settings-owners",14),A.NdJ("ownerEmitter",function(e){return A.CHM(i),A.oxw().owners=e}),A.qZA()}}function Xn(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function Wn(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"app-facility-hosts",15),A.NdJ("hostEmitter",function(e){return A.CHM(i),A.oxw().hosts=e}),A.qZA()}2&e&&A.Q6J("disableRouting",!0)}function Kn(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICES"))}var es=function(){return["select","id","name","enabled","description"]};function ts(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"h1",16),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"app-alert",17),A._uU(4),A.ALo(5,"translate"),A.qZA(),A.TgZ(6,"div",18),A.TgZ(7,"perun-web-apps-immediate-filter",19),A.NdJ("filter",function(e){return A.CHM(i),A.oxw().applyFilter(e)}),A.qZA(),A.TgZ(8,"perun-web-apps-service-package-search-select",20),A.NdJ("packageSelected",function(e){return A.CHM(i),A.oxw().packagesSelected(e)}),A.qZA(),A.qZA(),A.TgZ(9,"app-services-list",21),A.NdJ("selectionChanged",function(){return A.CHM(i),A.oxw().singleServiceSelected()}),A.qZA()}if(2&e){var a=A.oxw();A.xp6(1),A.Oqu(A.lcZ(2,13,"FACILITY_CONFIGURATION.SERVICES")),A.xp6(3),A.hij(" ",A.lcZ(5,15,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),A.xp6(3),A.Q6J("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),A.xp6(1),A.Q6J("servicePackages",a.servicePackages)("selectedPackage",a.selectedPackages)("multiple",!0)("disableAutoSelect",!0)("theme","facility-theme"),A.xp6(1),A.Q6J("disableRouting",!0)("selection",a.selection)("services",a.services)("filterValue",a.filterValue)("displayedColumns",A.DdM(17,es))}}function is(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function as(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"perun-web-apps-service-search-select",27),A.NdJ("serviceSelected",function(e){return A.CHM(i),A.oxw(2).filterAttributes(e)}),A.qZA()}if(2&e){var a=A.oxw(2);A.Q6J("disableAutoSelect",!0)("services",a.selection.selected)("multiple",!0)("theme","facility-theme")}}function ns(e,t){1&e&&A._UZ(0,"mat-spinner",28)}function ss(e,t){if(1&e&&A._UZ(0,"perun-web-apps-attributes-list",29),2&e){var i=A.oxw(2);A.Q6J("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("selection",i.attSelection)("attributes",i.filteredAttributes)}}function ls(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"h1",16),A._uU(1),A.ALo(2,"translate"),A.qZA(),A.TgZ(3,"app-alert",17),A._uU(4),A.ALo(5,"translate"),A.qZA(),A.TgZ(6,"div",18),A.TgZ(7,"button",22),A.NdJ("click",function(){return A.CHM(i),A.oxw().onRemoveAttributes()}),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.TgZ(10,"button",23),A.NdJ("click",function(){return A.CHM(i),A.oxw().onSaveAttributes()}),A._uU(11),A.ALo(12,"translate"),A.qZA(),A.YNc(13,as,1,4,"perun-web-apps-service-search-select",24),A.qZA(),A.YNc(14,ns,1,0,"mat-spinner",25),A.YNc(15,ss,1,3,"perun-web-apps-attributes-list",26)}if(2&e){var a=A.oxw(),n=A.MAs(5);A.xp6(1),A.Oqu(A.lcZ(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),A.xp6(3),A.hij(" ",A.lcZ(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),A.xp6(3),A.Q6J("disabled",0===a.attSelection.selected.length),A.xp6(1),A.hij(" ",A.lcZ(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),A.xp6(2),A.Q6J("disabled",0===a.attSelection.selected.length),A.xp6(1),A.hij(" ",A.lcZ(12,15,"FACILITY_CONFIGURATION.SAVE")," "),A.xp6(2),A.Q6J("ngIf",n.selectedIndex===a.ATTRIBUTES_IDX),A.xp6(1),A.Q6J("ngIf",a.processing),A.xp6(1),A.Q6J("ngIf",!a.processing)}}function rs(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}var os=function(){return["select","destinationId","service","warn","destination","type","propagationType"]};function cs(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"app-perun-web-apps-facility-services-destinations",30),A.NdJ("destinationEmitter",function(e){return A.CHM(i),A.oxw().destinations=e}),A.qZA()}if(2&e){var a=A.oxw();A.Q6J("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")("loading",a.processing)("displayedColumns",A.DdM(5,os))("configServices",a.selection.selected)("configServicesIds",a.serviceIds)}}function us(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function ds(e,t){1&e&&A._UZ(0,"app-perun-web-apps-facility-settings-managers",31),2&e&&A.Q6J("disableRouting",!0)("disableSelf",!0)}function hs(e,t){1&e&&(A._uU(0),A.ALo(1,"translate")),2&e&&A.Oqu(A.lcZ(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function fs(e,t){1&e&&A._UZ(0,"mat-spinner",28)}var ps=function(){return["id","name","contact","type"]};function gs(e,t){if(1&e&&A._UZ(0,"perun-web-apps-owners-list",48),2&e){var i=A.oxw(3);A.Q6J("owners",i.owners)("displayedColumns",A.DdM(2,ps))}}function ms(e,t){1&e&&A._UZ(0,"mat-spinner",28)}var vs=function(){return["id","name"]};function As(e,t){if(1&e&&A._UZ(0,"app-hosts-list",49),2&e){var i=A.oxw(3);A.Q6J("disableRouting",!0)("hosts",i.hosts)("displayedColumns",A.DdM(3,vs))}}function Is(e,t){1&e&&A._UZ(0,"mat-spinner",28)}var Ss=function(){return["id","name","enabled","script","description"]},Ts=function(){return["id","displayName","value","description"]},ys=function(){return["destinationId","service","warn","destination","type","propagationType"]},bs=function(){return["id","name","email","logins","organization"]},Es=function(){return["id","vo","name","description"]};function Zs(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"mat-accordion"),A.TgZ(1,"mat-expansion-panel",34),A.TgZ(2,"mat-expansion-panel-header"),A.TgZ(3,"mat-panel-title"),A._UZ(4,"mat-icon",35),A._uU(5),A.ALo(6,"translate"),A.qZA(),A.qZA(),A.TgZ(7,"h1",16),A._uU(8),A.ALo(9,"translate"),A.qZA(),A.YNc(10,fs,1,0,"mat-spinner",25),A.YNc(11,gs,1,3,"perun-web-apps-owners-list",36),A.qZA(),A.TgZ(12,"mat-expansion-panel",34),A.TgZ(13,"mat-expansion-panel-header"),A.TgZ(14,"mat-panel-title"),A._UZ(15,"mat-icon",37),A._uU(16),A.ALo(17,"translate"),A.qZA(),A.qZA(),A.TgZ(18,"h1",16),A._uU(19),A.ALo(20,"translate"),A.qZA(),A.YNc(21,ms,1,0,"mat-spinner",25),A.YNc(22,As,1,4,"app-hosts-list",38),A.qZA(),A.TgZ(23,"mat-expansion-panel",34),A.TgZ(24,"mat-expansion-panel-header"),A.TgZ(25,"mat-panel-title"),A._UZ(26,"mat-icon",39),A._uU(27),A.ALo(28,"translate"),A.qZA(),A.qZA(),A.TgZ(29,"h1",16),A._uU(30),A.ALo(31,"translate"),A.qZA(),A._UZ(32,"app-services-list",40),A.qZA(),A.TgZ(33,"mat-expansion-panel",41),A.NdJ("opened",function(){return A.CHM(i),A.oxw(2).getNonEmptyAttributes()}),A.TgZ(34,"mat-expansion-panel-header"),A.TgZ(35,"mat-panel-title"),A._UZ(36,"mat-icon",37),A._uU(37),A.ALo(38,"translate"),A.qZA(),A.qZA(),A.TgZ(39,"h1",16),A._uU(40),A.ALo(41,"translate"),A.qZA(),A._UZ(42,"perun-web-apps-attributes-list",42),A.qZA(),A.TgZ(43,"mat-expansion-panel",43),A.NdJ("expandedChange",function(e){return A.CHM(i),A.oxw(2).destinationServiceMissing=e}),A.TgZ(44,"mat-expansion-panel-header"),A.TgZ(45,"mat-panel-title"),A._UZ(46,"mat-icon",44),A._uU(47),A.ALo(48,"translate"),A.qZA(),A.qZA(),A.TgZ(49,"h1",16),A._uU(50),A.ALo(51,"translate"),A.qZA(),A.YNc(52,Is,1,0,"mat-spinner",25),A._UZ(53,"app-perun-web-apps-destination-list",45),A.qZA(),A.TgZ(54,"mat-expansion-panel"),A.TgZ(55,"mat-expansion-panel-header"),A.TgZ(56,"mat-panel-title"),A._UZ(57,"mat-icon",46),A._uU(58),A.ALo(59,"translate"),A.qZA(),A.qZA(),A._UZ(60,"app-managers-page",47),A.qZA(),A.qZA()}if(2&e){var a=A.oxw(2);A.Q6J("@.disabled",!0),A.xp6(1),A.Q6J("disabled",0===a.owners.length),A.xp6(1),A.ekj("cursor-default",0===a.owners.length),A.xp6(3),A.hij(" ",A.lcZ(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),A.xp6(3),A.Oqu(A.lcZ(9,51,"FACILITY_CONFIGURATION.OWNERS")),A.xp6(2),A.Q6J("ngIf",a.processing),A.xp6(1),A.Q6J("ngIf",!a.processing),A.xp6(1),A.Q6J("disabled",0===a.hosts.length),A.xp6(1),A.ekj("cursor-default",0===a.hosts.length),A.xp6(3),A.hij(" ",A.lcZ(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),A.xp6(3),A.Oqu(A.lcZ(20,55,"FACILITY_CONFIGURATION.HOSTS")),A.xp6(2),A.Q6J("ngIf",a.processing),A.xp6(1),A.Q6J("ngIf",!a.processing),A.xp6(1),A.Q6J("disabled",0===a.selection.selected.length),A.xp6(1),A.ekj("cursor-default",0===a.selection.selected.length),A.xp6(3),A.hij(" ",A.lcZ(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),A.xp6(3),A.Oqu(A.lcZ(31,59,"FACILITY_CONFIGURATION.SERVICES")),A.xp6(2),A.Q6J("disableRouting",!0)("services",a.selection.selected)("displayedColumns",A.DdM(71,Ss)),A.xp6(1),A.Q6J("disabled",0===a.selection.selected.length),A.xp6(1),A.ekj("cursor-default",0===a.selection.selected.length),A.xp6(3),A.hij(" ",A.lcZ(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),A.xp6(3),A.Oqu(A.lcZ(41,63,"FACILITY_CONFIGURATION.ATTS")),A.xp6(2),A.Q6J("displayedColumns",A.DdM(72,Ts))("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",a.filteredAttributes),A.xp6(1),A.Q6J("expanded",a.destinationServiceMissing)("disabled",0===a.selection.selected.length&&0===a.destinations.length),A.xp6(1),A.ekj("cursor-default",0===a.selection.selected.length&&0===a.destinations.length),A.xp6(3),A.hij(" ",A.lcZ(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),A.xp6(3),A.Oqu(A.lcZ(51,67,"FACILITY_CONFIGURATION.DESTINATION")),A.xp6(2),A.Q6J("ngIf",a.processing),A.xp6(1),A.Q6J("destinations",a.destinations)("services",a.serviceIds)("displayedColumns",A.DdM(73,ys)),A.xp6(5),A.hij(" ",A.lcZ(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),A.xp6(2),A.Q6J("complementaryObject",a.facility)("configMode",!0)("disableRouting",!0)("complementaryObjectType","Facility")("availableRoles",a.availableRoles)("displayedUserColumns",A.DdM(74,bs))("displayedGroupColumns",A.DdM(75,Es))}}function Cs(e,t){if(1&e&&(A.TgZ(0,"app-alert",17),A._UZ(1,"i",32),A.ALo(2,"translate"),A.qZA(),A.YNc(3,Zs,61,76,"mat-accordion",33)),2&e){A.oxw();var i=A.MAs(5);A.xp6(1),A.Q6J("innerHTML",A.lcZ(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),A.oJD),A.xp6(2),A.Q6J("ngIf",i.selectedIndex===i.steps.length-1)}}function _s(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",50),A.NdJ("click",function(){return A.CHM(i),A.oxw().back()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function ks(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",51),A.NdJ("click",function(){return A.CHM(i),A.oxw().next()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}if(2&e){A.oxw();var a=A.MAs(5);A.ekj("mr-2",void 0!==a&&0!==a.selectedIndex)("ml-auto",!(void 0!==a&&0!==a.selectedIndex)),A.xp6(1),A.hij(" ",A.lcZ(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function Os(e,t){if(1&e){var i=A.EpF();A.TgZ(0,"button",52),A.NdJ("click",function(){return A.CHM(i),A.oxw().onFinish()}),A._uU(1),A.ALo(2,"translate"),A.qZA()}2&e&&(A.xp6(1),A.hij(" ",A.lcZ(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}var Ls,xs=function(){var t=function(){function t(e,i,a,n,l,r,o,c,u,d){var h=this;s(this,t),this.attributesManager=e,this.serviceManager=i,this.facilityService=a,this.cd=n,this.dialog=l,this.notificator=r,this.translate=o,this.router=c,this.guiAuthResolver=u,this.entityStorageService=d,this.processing=!1,this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.filteredAttributes=[],this.attributesPerService=new Map,this.attSelection=new Le.Ov(!0,[]),this.services=[],this.serviceIds=new Set,this.servicesPerPackage=new Map,this.servicePackages=[],this.selectedPackages=[],this.selection=new Le.Ov(!0,[]),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.ATTRIBUTES_IDX=3,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.serviceControl=new le.NI(!1,le.kI.requiredTrue),this.attributesControl=new le.NI(!0,le.kI.requiredTrue),this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(function(e){return h.saveMsg=e}),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(function(e){return h.removeMsg=e})}return r(t,[{key:"ngOnInit",value:function(){var e=this;this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(function(t){e.servicePackages=t,e.getServicePackageServices(t,0)})}},{key:"ngAfterViewInit",value:function(){var e=this;this.cd.detectChanges(),this.attSelection.changed.subscribe(function(){e.attributesControl.setValue(0===e.attSelection.selected.length)})}},{key:"onCancel",value:function(){var e=this,t=(0,p.kZ)();t.width="550px",t.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(Qn,t).afterClosed().subscribe(function(t){t&&(e.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),e.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}},{key:"getServicePackageServices",value:function(t,i){var a=this;i===t.length?this.serviceManager.getServices().subscribe(function(e){a.services=e}):this.serviceManager.getServicesFromServicesPackage(t[i].id).subscribe(function(n){a.servicesPerPackage.set(t[i].id,new Set(e(n.map(function(e){return e.id})))),a.getServicePackageServices(t,i+1)})}},{key:"getServiceRequiredAttributes",value:function(e,t){var i=this;t!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[t].id).subscribe(function(a){a=a.filter(function(e){return i.attributeIds.has(e.id)}),i.attributesPerService.set(e[t].id,a.map(function(e){return e.id})),i.getServiceRequiredAttributes(e,t+1)})}},{key:"setServiceControl",value:function(){this.serviceControl.setValue(0!==this.selection.selected.length)}},{key:"buildServiceSet",value:function(e){var t=this,i=new Set;return e.forEach(function(e){t.servicesPerPackage.get(e.id).forEach(function(e){return i.add(e)})}),i}},{key:"setDiff",value:function(t,i){return new Set(e(t).filter(function(e){return!i.has(e)}))}},{key:"setIntersect",value:function(t,i){return new Set(e(t).filter(function(e){return i.has(e)}))}},{key:"setSymDif",value:function(t,i){var a=this.buildServiceSet(t),n=this.buildServiceSet(i),s=this.setDiff(a,n),l=this.setDiff(n,a);return new Set([].concat(e(s),e(l)))}},{key:"filterService",value:function(e,t){var a,n=new Set,s=i(t);try{for(s.s();!(a=s.n()).done;){var l=a.value,r=this.setIntersect(e,this.servicesPerPackage.get(l.id));0!==r.size&&r.forEach(function(e){return n.add(e)})}}catch(o){s.e(o)}finally{s.f()}return n}},{key:"packageSelectionEqual",value:function(e){var t=this;return e.length===this.selectedPackages.length&&(e.forEach(function(e){if(-1===t.selectedPackages.findIndex(function(t){return t.id===e.id}))return!1}),!0)}},{key:"packagesSelected",value:function(e){var t=this;if(!this.packageSelectionEqual(e)){this.processing=!0;var a=new Set;if(e&&0!==e.length?a=this.setSymDif(this.selectedPackages,e):this.selectedPackages.forEach(function(e){t.servicesPerPackage.get(e.id).forEach(function(e){return a.add(e)})}),0!==a.size){var n,s=this.filterService(a,e.filter(function(e){return t.selectedPackages.findIndex(function(t){return t.id===e.id})<0})),l=this.filterService(a,this.selectedPackages.filter(function(t){return e.findIndex(function(e){return e.id===t.id})<0})),r=i(this.services);try{for(r.s();!(n=r.n()).done;){var o=n.value;s.has(o.id)?this.selection.select(o):l.has(o.id)&&this.selection.deselect(o)}}catch(c){r.e(c)}finally{r.f()}this.selectedPackages=e,this.setServiceControl(),this.processing=!1}}}},{key:"checkPackageComplete",value:function(){var e,t=this,a=[],n=i(this.selectedPackages);try{for(n.s();!(e=n.n()).done;){var s,l=e.value,r=!0,o=i(this.servicesPerPackage.get(l.id));try{var c=function(){var e=s.value;if(-1===t.selection.selected.findIndex(function(t){return t.id===e}))return r=!1,"break"};for(o.s();!(s=o.n()).done;){if("break"===c())break}}catch(u){o.e(u)}finally{o.f()}r&&a.push(l)}}catch(u){n.e(u)}finally{n.f()}this.selectedPackages=a}},{key:"singleServiceSelected",value:function(){this.setServiceControl(),this.processing||this.checkPackageComplete()}},{key:"back",value:function(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&0===this.selection.selected.length?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}},{key:"openSkipDialog",value:function(){var e=this,t=(0,p.kZ)();t.width="400px",t.data={theme:"facility-theme"},this.dialog.open(Yn,t).afterClosed().subscribe(function(t){t&&(e.serviceControl.setValue(!0),e.stepper.selectedIndex=e.AFTER_OPTIONAL_IDX)})}},{key:"getRequiredAttributes",value:function(){var e=this;this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(function(e){return e.id}),this.facility.id).subscribe(function(t){e.attSelection.clear(),e.attributes=t.filter(function(e){return!(0,p.Hm)(e)}),e.filteredAttributes=e.attributes,e.attributes.forEach(function(t){return e.attributeIds.add(t.id)}),e.getServiceRequiredAttributes(e.selection.selected,0),e.processing=!1})}},{key:"onSaveAttributes",value:function(){var e=this;return new Promise(function(t,i){e.processing=!0,e.attributesManager.setFacilityAttributes({facility:e.facility.id,attributes:e.attSelection.selected}).subscribe(function(){e.notificator.showSuccess(e.saveMsg),e.attSelection.clear(),e.processing=!1,t()},function(){e.processing=!1,i()})})}},{key:"openUnsavedAttsDialog",value:function(){var e=this,t=(0,p.kZ)();t.width="400px",t.data={theme:"facility-theme"},this.dialog.open(Un,t).afterClosed().subscribe(function(t){t&&e.onSaveAttributes().then(function(){e.stepper.next()},function(){return e.getRequiredAttributes()})})}},{key:"next",value:function(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?0===this.selection.selected.length?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX&&0!==this.attSelection.selected.length?this.openUnsavedAttsDialog():this.stepper.next()}},{key:"onFinish",value:function(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}},{key:"onRemoveAttributes",value:function(){var e=this;this.processing=!0;var t=this.attSelection.selected.map(function(e){return e.id});this.attributesManager.removeFacilityAttributes(this.facility.id,t).subscribe(function(){e.notificator.showSuccess(e.removeMsg),e.getRequiredAttributes(),e.processing=!1})}},{key:"filterAttributes",value:function(e){if(void 0!==e&&0!==e.length){var t,a=new Set,n=i(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;this.attributesPerService.get(s.id).forEach(function(e){return a.add(e)})}}catch(c){n.e(c)}finally{n.f()}this.filteredAttributes=[];var l,r=i(this.attributes);try{for(r.s();!(l=r.n()).done;){var o=l.value;a.has(o.id)&&this.filteredAttributes.push(o)}}catch(c){r.e(c)}finally{r.f()}}else this.filteredAttributes=this.attributes}},{key:"getNonEmptyAttributes",value:function(){this.filteredAttributes=this.attributes.filter(function(e){if(e.value&&(!(0,Vn.k)(e.value)||0!==e.value.length))return e})}},{key:"checkDestinationDependency",value:function(t){t!==this.BEFORE_OPTIONAL_IDX&&t!==this.DESTINATIONS_IDX||(this.serviceIds=new Set(e(this.selection.selected.map(function(e){return e.id}))),this.destinationServicePresent())}},{key:"navigationStep",value:function(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}},{key:"getOwners",value:function(){var e=this;this.processing=!0,this.facilityService.getFacilityOwners(this.facility.id).subscribe(function(t){e.owners=t,e.processing=!1})}},{key:"getHosts",value:function(){var e=this;this.processing=!0,this.facilityService.getHosts(this.facility.id).subscribe(function(t){e.hosts=t,e.processing=!1})}},{key:"applyFilter",value:function(e){this.filterValue=e}},{key:"destinationServicePresent",value:function(){var e,t=i(this.destinations);try{for(t.s();!(e=t.n()).done;){var a=e.value;if(!this.serviceIds.has(a.service.id))return void(this.destinationServiceMissing=!0)}}catch(n){t.e(n)}finally{t.f()}this.destinationServiceMissing=!1}},{key:"canDeactivate",value:function(){return this.allowNavigate||this.onCancel(),this.allowNavigate}}]),t}();return t.\u0275fac=function(e){return new(e||t)(A.Y36(f.H8),A.Y36(f.KK),A.Y36(f.IQ),A.Y36(A.sBO),A.Y36(I.uw),A.Y36(g.V6),A.Y36(_.sK),A.Y36(c.F0),A.Y36(g.x4),A.Y36(g.fb))},t.\u0275cmp=A.Xpm({type:t,selectors:[["app-facility-configuration-page"]],viewQuery:function(e,t){var i;(1&e&&A.Gf(jn,5),2&e)&&(A.iGM(i=A.CRH())&&(t.stepper=i.first))},decls:34,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"stepControl","editable"],[3,"optional","editable"],[1,"actions"],["mat-flat-button","",3,"click"],["class","ml-auto mr-2","mat-flat-button","",3,"click",4,"ngIf"],["mat-flat-button","","color","accent",3,"mr-2","ml-auto","click",4,"ngIf"],["class","mr-2","mat-flat-button","","color","accent",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"servicePackages","selectedPackage","multiple","disableAutoSelect","theme","packageSelected"],[3,"disableRouting","selection","services","filterValue","displayedColumns","selectionChanged"],["mat-flat-button","","color","warn",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","accent",1,"mr-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],["class","ml-auto mr-auto",4,"ngIf"],[3,"emptyListText","selection","attributes",4,"ngIf"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[1,"ml-auto","mr-auto"],[3,"emptyListText","selection","attributes"],[3,"title","loading","displayedColumns","configServices","configServicesIds","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"mr-2"],[3,"owners","displayedColumns",4,"ngIf"],["svgIcon","perun-hosts",1,"mr-2"],[3,"disableRouting","hosts","displayedColumns",4,"ngIf"],["svgIcon","perun-service",1,"mr-2"],[3,"disableRouting","services","displayedColumns"],[3,"disabled","opened"],[3,"displayedColumns","emptyListText","attributes"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"mr-2"],[3,"destinations","services","displayedColumns"],["svgIcon","perun-manager",1,"mr-2"],[3,"complementaryObject","configMode","disableRouting","complementaryObjectType","availableRoles","displayedUserColumns","displayedGroupColumns"],[3,"owners","displayedColumns"],[3,"disableRouting","hosts","displayedColumns"],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["mat-flat-button","","color","accent",3,"click"],["mat-flat-button","","color","accent",1,"mr-2",3,"click"]],template:function(e,t){if(1&e&&(A.TgZ(0,"div",0),A.TgZ(1,"div",1),A._uU(2),A.ALo(3,"translate"),A.qZA(),A.TgZ(4,"mat-stepper",2,3),A.NdJ("selectionChange",function(e){return t.navigationStep(e)}),A.TgZ(6,"mat-step"),A.YNc(7,$n,2,3,"ng-template",4),A.YNc(8,zn,1,0,"ng-template",5),A.qZA(),A.TgZ(9,"mat-step"),A.YNc(10,Xn,2,3,"ng-template",4),A.YNc(11,Wn,1,1,"ng-template",5),A.qZA(),A.TgZ(12,"mat-step",6),A.YNc(13,Kn,2,3,"ng-template",4),A.YNc(14,ts,10,18,"ng-template",5),A.qZA(),A.TgZ(15,"mat-step",7),A.YNc(16,is,2,3,"ng-template",4),A.YNc(17,ls,16,17,"ng-template",5),A.qZA(),A.TgZ(18,"mat-step",8),A.YNc(19,rs,2,3,"ng-template",4),A.YNc(20,cs,1,6,"ng-template",5),A.qZA(),A.TgZ(21,"mat-step"),A.YNc(22,us,2,3,"ng-template",4),A.YNc(23,ds,1,2,"ng-template",5),A.qZA(),A.TgZ(24,"mat-step"),A.YNc(25,hs,2,3,"ng-template",4),A.YNc(26,Cs,4,4,"ng-template",5),A.qZA(),A.qZA(),A.TgZ(27,"div",9),A.TgZ(28,"button",10),A.NdJ("click",function(){return t.onCancel()}),A._uU(29),A.ALo(30,"translate"),A.qZA(),A.YNc(31,_s,3,3,"button",11),A.YNc(32,ks,3,7,"button",12),A.YNc(33,Os,3,3,"button",13),A.qZA(),A.qZA()),2&e){var i=A.MAs(5);A.xp6(2),A.hij(" ",A.lcZ(3,11,"FACILITY_CONFIGURATION.TITLE")," "),A.xp6(2),A.Q6J("linear",!0),A.xp6(8),A.Q6J("stepControl",t.serviceControl),A.xp6(3),A.Q6J("stepControl",t.attributesControl)("editable",0!==t.selection.selected.length),A.xp6(3),A.Q6J("optional",0===t.destinations.length)("editable",0!==t.selection.selected.length||0!==t.destinations.length),A.xp6(11),A.hij(" ",A.lcZ(30,13,"FACILITY_CONFIGURATION.CANCEL")," "),A.xp6(2),A.Q6J("ngIf",void 0!==i&&0!==i.selectedIndex),A.xp6(1),A.Q6J("ngIf",void 0!==i&&i.selectedIndex!==i.steps.length-1),A.xp6(1),A.Q6J("ngIf",void 0!==i&&i.selectedIndex===i.steps.length-1)}},directives:[Hn.Vq,Hn.C0,Hn.VY,Hn.BY,C.lW,o.O5,St,Wt,je.w,Be.L,Pn.F,Gn.Q,Xa,y.$g,Ai.p,at,ke,Bn.pp,Bn.ib,Bn.yz,Bn.yK,b.Hw,$e.q,_e.s,nt.Q,Bt],pipes:[_.X$],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]}),t}(),Ns=function(){var e=function(){function e(t){s(this,e),this.router=t}return r(e,[{key:"canActivate",value:function(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")||(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}},{key:"canDeactivate",value:function(e){return e.canDeactivate()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(A.LFG(c.F0))},e.\u0275prov=A.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Rs=[{path:"",component:u.P},{path:":facilityId",component:D,children:[{path:"",component:U,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:te,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:q.f,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:nn,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:M.o,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:Va,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:wn,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:Ce,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:at,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:Wt,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:yi,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:V,children:[{path:"",component:G,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:St,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:ke,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:Ui,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:pi,data:{animation:"FacilitySettingsBlackListPage"}}]},{path:"configuration",component:xs,canActivate:[Ns],canDeactivate:[Ns]}]},{path:":facilityId/resources/:resourceId",component:J.b,children:[{path:"",component:Q.H,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:ne.X,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:se.K,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:Mi.D,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:sn.y,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:Fn.v,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:ie.t,children:[{path:"",component:ae.h,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:qi.O,data:{animation:"ResourceSettingsManagersPage"}}]}]}],Ds=function(){var e=function e(){s(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=A.oAB({type:e}),e.\u0275inj=A.cJS({imports:[[c.Bz.forChild(Rs)],c.Bz]}),e}(),ws=l(28780),Fs=l(22727),Ys=l(65515),Us=l(21781),qs=((Ls=function e(){s(this,e)}).\u0275fac=function(e){return new(e||Ls)},Ls.\u0275mod=A.oAB({type:Ls}),Ls.\u0275inj=A.cJS({providers:[ce.dp],imports:[[o.ez,Ds,ws.m,Fs.r,gi.ez,ce.d4,Ys.UsersModule,Us.AdminModule]]}),Ls)}}])}();